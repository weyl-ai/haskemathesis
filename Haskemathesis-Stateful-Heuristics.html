<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Haskemathesis.Stateful.Heuristics</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">haskemathesis-0.1.0.0</span><ul class="links" id="page-menu"><li><a href="src/Haskemathesis.Stateful.Heuristics.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Haskemathesis.Stateful.Heuristics</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Combined Link Inference</a></li><li><a href="#g:2">Path-Based Inference</a></li><li><a href="#g:3">Schema-Based Inference</a></li><li><a href="#g:4">Naming Normalization</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Heuristic link detection for stateful API testing.</p><p>This module infers links between API operations when explicit OpenAPI Links
are not defined. It uses heuristics based on:</p><ol><li value="1"><strong>Path pattern matching</strong>: <code>POST /users</code> links to <code>GET <em>users</em>{id}</code></li><li value="2"><strong>Response schema analysis</strong>: Response field <code>id</code> matches path param <code>{id}</code></li><li value="3"><strong>Naming conventions</strong>: <code>userId</code> in response matches <code>user_id</code> parameter</li></ol><p>These heuristics enable stateful testing even for specs without explicit links.</p><h3>Usage</h3><pre>import Haskemathesis.Stateful.Heuristics
import Haskemathesis.Stateful.Links (extractLinks)

-- Combine explicit and inferred links
allLinks :: OpenApi -&gt; [ResolvedOperation] -&gt; [OperationLink]
allLinks spec ops = extractLinks spec &lt;&gt; inferLinks ops
</pre></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:inferLinks">inferLinks</a> :: [<a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a>] -&gt; [<a href="Haskemathesis-Stateful-Types.html#t:OperationLink" title="Haskemathesis.Stateful.Types">OperationLink</a>]</li><li class="src short"><a href="#v:inferLinksFromPaths">inferLinksFromPaths</a> :: [<a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a>] -&gt; [<a href="Haskemathesis-Stateful-Types.html#t:OperationLink" title="Haskemathesis.Stateful.Types">OperationLink</a>]</li><li class="src short"><a href="#v:findRelatedOperations">findRelatedOperations</a> :: [<a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a>] -&gt; <a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a> -&gt; [<a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a>]</li><li class="src short"><a href="#v:extractBasePath">extractBasePath</a> :: <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a></li><li class="src short"><a href="#v:extractPathParams">extractPathParams</a> :: <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; [<a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a>]</li><li class="src short"><a href="#v:inferLinksFromSchemas">inferLinksFromSchemas</a> :: [<a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a>] -&gt; [<a href="Haskemathesis-Stateful-Types.html#t:OperationLink" title="Haskemathesis.Stateful.Types">OperationLink</a>]</li><li class="src short"><a href="#v:matchResponseFieldsToParams">matchResponseFieldsToParams</a> :: [<a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a>] -&gt; [<a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a>] -&gt; [(<a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a>, <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a>)]</li><li class="src short"><a href="#v:normalizeParamName">normalizeParamName</a> :: <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a></li><li class="src short"><a href="#v:namesMatch">namesMatch</a> :: <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/base-4.20.2.0-7807/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Combined Link Inference</h1></a><div class="top"><p class="src"><a id="v:inferLinks" class="def">inferLinks</a> :: [<a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a>] -&gt; [<a href="Haskemathesis-Stateful-Types.html#t:OperationLink" title="Haskemathesis.Stateful.Types">OperationLink</a>] <a href="src/Haskemathesis.Stateful.Heuristics.html#inferLinks" class="link">Source</a> <a href="#v:inferLinks" class="selflink">#</a></p><div class="doc"><p>Infer all links from a list of operations using heuristics.</p><p>Combines path-based and schema-based inference, deduplicating results.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>inferLinks [postUsersOp, getUsersIdOp, deleteUsersIdOp]
</code></strong>[OperationLink &quot;createUser&quot; &quot;getUser&quot; [...], OperationLink &quot;createUser&quot; &quot;deleteUser&quot; [...]]
</pre></div></div><a href="#g:2" id="g:2"><h1>Path-Based Inference</h1></a><div class="top"><p class="src"><a id="v:inferLinksFromPaths" class="def">inferLinksFromPaths</a> :: [<a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a>] -&gt; [<a href="Haskemathesis-Stateful-Types.html#t:OperationLink" title="Haskemathesis.Stateful.Types">OperationLink</a>] <a href="src/Haskemathesis.Stateful.Heuristics.html#inferLinksFromPaths" class="link">Source</a> <a href="#v:inferLinksFromPaths" class="selflink">#</a></p><div class="doc"><p>Infer links based on path pattern matching.</p><p>Detects common REST patterns:</p><ul><li><code>POST /resources</code> -&gt; <code>GET <em>resources</em>{id}</code></li><li><code>POST /resources</code> -&gt; <code>PUT <em>resources</em>{id}</code></li><li><code>POST /resources</code> -&gt; <code>DELETE <em>resources</em>{id}</code></li><li><code>POST /resources</code> -&gt; <code>PATCH <em>resources</em>{id}</code></li></ul><p>Also handles nested resources like <code>POST <em>users</em>{userId}/posts</code> -&gt;
<code>GET <em>users</em>{userId}<em>posts</em>{id}</code>.</p><h3>Algorithm</h3><ol><li value="1">Find all &quot;creator&quot; operations (POST methods)</li><li value="2">For each creator, find operations with same base path plus additional params</li><li value="3">Create links with bindings from response body to path params</li></ol></div></div><div class="top"><p class="src"><a id="v:findRelatedOperations" class="def">findRelatedOperations</a> :: [<a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a>] -&gt; <a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a> -&gt; [<a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a>] <a href="src/Haskemathesis.Stateful.Heuristics.html#findRelatedOperations" class="link">Source</a> <a href="#v:findRelatedOperations" class="selflink">#</a></p><div class="doc"><p>Find operations related to a creator by path pattern.</p><p>An operation is related if:</p><ol><li value="1">It has the same base path as the creator</li><li value="2">It has additional path parameters</li><li value="3">It's a different method (GET, PUT, DELETE, PATCH)</li></ol><h3>Example</h3><p>For <code>POST /users</code>, related operations might include:</p><ul><li><pre>GET <em>users</em>{id}</pre></li><li><pre>PUT <em>users</em>{id}</pre></li><li><pre>DELETE <em>users</em>{id}</pre></li><li><pre>PATCH <em>users</em>{id}</pre></li></ul></div></div><div class="top"><p class="src"><a id="v:extractBasePath" class="def">extractBasePath</a> :: <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> <a href="src/Haskemathesis.Stateful.Heuristics.html#extractBasePath" class="link">Source</a> <a href="#v:extractBasePath" class="selflink">#</a></p><div class="doc"><p>Extract the base path from a path template.</p><p>Removes path parameter segments to get the &quot;collection&quot; path.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>extractBasePath &quot;/users/{id}&quot;
</code></strong>&quot;/users&quot;
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>extractBasePath &quot;/users/{userId}/posts/{postId}&quot;
</code></strong>&quot;/users/{userId}/posts&quot;
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>extractBasePath &quot;/users&quot;
</code></strong>&quot;/users&quot;
</pre></div></div><div class="top"><p class="src"><a id="v:extractPathParams" class="def">extractPathParams</a> :: <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; [<a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a>] <a href="src/Haskemathesis.Stateful.Heuristics.html#extractPathParams" class="link">Source</a> <a href="#v:extractPathParams" class="selflink">#</a></p><div class="doc"><p>Extract path parameter names from a path template.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>extractPathParams &quot;/users/{id}&quot;
</code></strong>[&quot;id&quot;]
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>extractPathParams &quot;/users/{userId}/posts/{postId}&quot;
</code></strong>[&quot;userId&quot;, &quot;postId&quot;]
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>extractPathParams &quot;/users&quot;
</code></strong>[]
</pre></div></div><a href="#g:3" id="g:3"><h1>Schema-Based Inference</h1></a><div class="top"><p class="src"><a id="v:inferLinksFromSchemas" class="def">inferLinksFromSchemas</a> :: [<a href="Haskemathesis-OpenApi-Types.html#t:ResolvedOperation" title="Haskemathesis.OpenApi.Types">ResolvedOperation</a>] -&gt; [<a href="Haskemathesis-Stateful-Types.html#t:OperationLink" title="Haskemathesis.Stateful.Types">OperationLink</a>] <a href="src/Haskemathesis.Stateful.Heuristics.html#inferLinksFromSchemas" class="link">Source</a> <a href="#v:inferLinksFromSchemas" class="selflink">#</a></p><div class="doc"><p>Infer links based on response schema field matching.</p><p>Analyzes response schemas to find fields that match path parameters
in other operations. This handles cases where:</p><ul><li>Response has <code>id</code> field -&gt; matches <code>{id}</code> parameter</li><li>Response has <code>userId</code> field -&gt; matches <code>{user_id}</code> parameter</li><li>Response has <code>resourceId</code> field -&gt; matches <code>{resourceId}</code> parameter</li></ul><h3>Algorithm</h3><ol><li value="1">For each operation with a response schema containing object fields</li><li value="2">Find operations with path parameters matching those field names</li><li value="3">Create links with bindings from response fields to parameters</li></ol></div></div><div class="top"><p class="src"><a id="v:matchResponseFieldsToParams" class="def">matchResponseFieldsToParams</a> :: [<a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a>] -&gt; [<a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a>] -&gt; [(<a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a>, <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a>)] <a href="src/Haskemathesis.Stateful.Heuristics.html#matchResponseFieldsToParams" class="link">Source</a> <a href="#v:matchResponseFieldsToParams" class="selflink">#</a></p><div class="doc"><p>Match response field names to path parameter names.</p><p>Uses flexible matching to handle naming conventions:</p><ul><li>Exact match: <code>id</code> -&gt; <code>id</code></li><li>Case normalization: <code>userId</code> -&gt; <code>user_id</code></li><li>Suffix matching: <code>resourceId</code> -&gt; <code>id</code> (when resource matches)</li></ul><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>matchResponseFieldsToParams [&quot;id&quot;, &quot;name&quot;] [&quot;id&quot;]
</code></strong>[(&quot;id&quot;, &quot;id&quot;)]
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>matchResponseFieldsToParams [&quot;userId&quot;] [&quot;user_id&quot;]
</code></strong>[(&quot;userId&quot;, &quot;user_id&quot;)]
</pre></div></div><a href="#g:4" id="g:4"><h1>Naming Normalization</h1></a><div class="top"><p class="src"><a id="v:normalizeParamName" class="def">normalizeParamName</a> :: <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> <a href="src/Haskemathesis.Stateful.Heuristics.html#normalizeParamName" class="link">Source</a> <a href="#v:normalizeParamName" class="selflink">#</a></p><div class="doc"><p>Normalize a parameter name for comparison.</p><p>Converts to a canonical form:</p><ul><li>Lowercase</li><li>camelCase -&gt; snake_case</li><li>Remove underscores for comparison</li></ul><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>normalizeParamName &quot;userId&quot;
</code></strong>&quot;userid&quot;
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>normalizeParamName &quot;user_id&quot;
</code></strong>&quot;userid&quot;
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>normalizeParamName &quot;UserID&quot;
</code></strong>&quot;userid&quot;
</pre></div></div><div class="top"><p class="src"><a id="v:namesMatch" class="def">namesMatch</a> :: <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/text-2.1.3-cd15/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; <a href="${pkgroot}/../../../../i6dn6airzp2fb6gj0vqpriavxp098129-ghc-9.10.3-doc/share/doc/ghc/html/libraries/base-4.20.2.0-7807/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="src/Haskemathesis.Stateful.Heuristics.html#namesMatch" class="link">Source</a> <a href="#v:namesMatch" class="selflink">#</a></p><div class="doc"><p>Check if a response field name matches a parameter name.</p><p>Handles common naming convention differences:</p><ul><li>Exact match</li><li>camelCase to snake_case: <code>userId</code> -&gt; <code>user_id</code></li><li>Different suffixes: <code>userId</code> -&gt; <code>id</code> (prefix stripped)</li><li>Case-insensitive: <code>ID</code> -&gt; <code>id</code></li></ul><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>namesMatch &quot;id&quot; &quot;id&quot;
</code></strong>True
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>namesMatch &quot;userId&quot; &quot;user_id&quot;
</code></strong>True
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>namesMatch &quot;userId&quot; &quot;userId&quot;
</code></strong>True
</pre><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>namesMatch &quot;id&quot; &quot;name&quot;
</code></strong>False
</pre></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.31.1</p></div></body></html>