<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">{- | HTTP executor for running generated requests against a base URL.

This module provides an executor that sends HTTP requests to a live server
using the @http-client@ library. It's used for testing APIs that are
already deployed or running on a specific host.

=== Basic Usage

@
import Network.HTTP.Client (newManager, defaultManagerSettings)
import Haskemathesis.Execute.Http (executeHttp)

main :: IO ()
main = do
    manager &lt;- newManager defaultManagerSettings
    let baseUrl = &quot;http://localhost:8080&quot;
    let request = ApiRequest { ... }
    response &lt;- executeHttp manager baseUrl request
    print (resStatusCode response)
@
-}</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Http.html"><span class="hs-identifier">Haskemathesis.Execute.Http</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Http.html#executeHttp"><span class="hs-identifier">executeHttp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Builder</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toLazyByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LBS</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeUtf8</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encodeUtf8</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html"><span class="hs-identifier">Haskemathesis.Execute.Types</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.html"><span class="hs-identifier">Network.HTTP.Client</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier">Manager</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#Request"><span class="hs-identifier">Request</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#RequestBody"><span class="hs-identifier">RequestBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#RequestBodyBS"><span class="hs-identifier">RequestBodyBS</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Core.html#httpLbs"><span class="hs-identifier">httpLbs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Request.html#parseRequest"><span class="hs-identifier">parseRequest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier">responseBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#responseHeaders"><span class="hs-identifier">responseHeaders</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#responseStatus"><span class="hs-identifier">responseStatus</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.html"><span class="hs-identifier">Network.HTTP.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.Header.html#hContentType"><span class="hs-identifier">hContentType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.URI.html#renderQueryText"><span class="hs-identifier">renderQueryText</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.Status.html#statusCode"><span class="hs-identifier">statusCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="annot"><span class="hs-comment">{- | Execute an HTTP request against a base URL.

This function takes an 'ApiRequest', converts it to an @http-client@
'Request', sends it using the provided 'Manager', and returns the
response as an 'ApiResponse'.

=== Parameters

* @manager@ - HTTP connection manager (from @http-client@)
* @baseUrl@ - Base URL of the API (e.g., &quot;http://localhost:8080&quot;)
* @req@ - The 'ApiRequest' to execute

=== Return Value

Returns an 'ApiResponse' containing the status code, headers, body,
and timing information.

=== Example

@
import Network.HTTP.Client (newManager, defaultManagerSettings)

main :: IO ()
main = do
    manager &lt;- newManager defaultManagerSettings
    let request = ApiRequest
            { reqMethod = &quot;GET&quot;
            , reqPath = &quot;/api/users&quot;
            , reqQueryParams = []
            , reqHeaders = []
            , reqBody = Nothing
            }
    response &lt;- executeHttp manager &quot;http://localhost:8080&quot; request
    putStrLn $ &quot;Status: &quot; ++ show (resStatusCode response)
@
-}</span></span><span>
</span><span id="line-80"></span><span class="annot"><a href="Haskemathesis.Execute.Http.html#executeHttp"><span class="hs-identifier hs-type">executeHttp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#Manager"><span class="hs-identifier hs-type">Manager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiRequest"><span class="hs-identifier hs-type">ApiRequest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiResponse"><span class="hs-identifier hs-type">ApiResponse</span></a></span><span>
</span><span id="line-81"></span><span id="executeHttp"><span class="annot"><span class="annottext">executeHttp :: Manager -&gt; BaseUrl -&gt; ApiRequest -&gt; IO ApiResponse
</span><a href="Haskemathesis.Execute.Http.html#executeHttp"><span class="hs-identifier hs-var hs-var">executeHttp</span></a></span></span><span> </span><span id="local-6989586621679198624"><span class="annot"><span class="annottext">Manager
</span><a href="#local-6989586621679198624"><span class="hs-identifier hs-var">manager</span></a></span></span><span> </span><span id="local-6989586621679198625"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679198625"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span id="local-6989586621679198626"><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679198626"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621679198627"><span class="annot"><a href="#local-6989586621679198627"><span class="hs-identifier hs-var">baseReq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Request
forall (m :: * -&gt; *). MonadThrow m =&gt; String -&gt; m Request
</span><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Request.html#parseRequest"><span class="hs-identifier hs-var">parseRequest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl -&gt; ApiRequest -&gt; String
</span><a href="Haskemathesis.Execute.Http.html#buildUrl"><span class="hs-identifier hs-var">buildUrl</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679198625"><span class="hs-identifier hs-var">baseUrl</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679198626"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679198629"><span class="annot"><a href="#local-6989586621679198629"><span class="hs-identifier hs-var hs-var">fullReq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>            </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621679198627"><span class="hs-identifier hs-var">baseReq</span></a></span><span>
</span><span id="line-85"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#method"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#reqMethod"><span class="hs-identifier hs-var">reqMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679198626"><span class="hs-identifier hs-type">req</span></a></span><span>
</span><span id="line-86"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#requestHeaders"><span class="hs-identifier hs-var">requestHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679198633"><span class="hs-identifier hs-type">contentTypeHeader</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#reqHeaders"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679198626"><span class="hs-identifier hs-type">req</span></a></span><span>
</span><span id="line-87"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#requestBody"><span class="hs-identifier hs-var">requestBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Http.html#requestBodyFrom"><span class="hs-identifier hs-type">requestBodyFrom</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679198626"><span class="hs-identifier hs-type">req</span></a></span><span>
</span><span id="line-88"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621679198637"><span class="annot"><a href="#local-6989586621679198637"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Core.html#httpLbs"><span class="hs-identifier hs-type">httpLbs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679198629"><span class="hs-identifier hs-type">fullReq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679198624"><span class="hs-identifier hs-type">manager</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-91"></span><span>        </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiResponse"><span class="hs-identifier hs-type">ApiResponse</span></a></span><span>
</span><span id="line-92"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#resStatusCode"><span class="hs-identifier hs-var">resStatusCode</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.Status.html#statusCode"><span class="hs-identifier hs-var">statusCode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#responseStatus"><span class="hs-identifier hs-var">responseStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679198637"><span class="hs-identifier hs-type">response</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#resHeaders"><span class="hs-identifier hs-var">resHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#responseHeaders"><span class="hs-identifier hs-var">responseHeaders</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679198637"><span class="hs-identifier hs-type">response</span></a></span><span>
</span><span id="line-94"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#resBody"><span class="hs-identifier hs-var">resBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LBS.toStrict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#responseBody"><span class="hs-identifier hs-var">responseBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679198637"><span class="hs-identifier hs-type">response</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#resTime"><span class="hs-identifier hs-var">resTime</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-96"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679198633"><span class="annot"><span class="annottext">contentTypeHeader :: [(HeaderName, ByteString)]
</span><a href="#local-6989586621679198633"><span class="hs-identifier hs-var hs-var">contentTypeHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiRequest -&gt; Maybe (BaseUrl, ByteString)
</span><a href="Haskemathesis.Execute.Types.html#reqBody"><span class="hs-identifier hs-var">reqBody</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679198626"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-100"></span><span>            </span><span class="annot"><span class="annottext">Maybe (BaseUrl, ByteString)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-101"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679198644"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679198644"><span class="hs-identifier hs-var">mediaType</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-102"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName
</span><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.Header.html#hContentType"><span class="hs-identifier hs-var">hContentType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679198644"><span class="hs-identifier hs-var">mediaType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><a href="Haskemathesis.Execute.Http.html#buildUrl"><span class="hs-identifier hs-type">buildUrl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#BaseUrl"><span class="hs-identifier hs-type">BaseUrl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiRequest"><span class="hs-identifier hs-type">ApiRequest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-105"></span><span id="buildUrl"><span class="annot"><span class="annottext">buildUrl :: BaseUrl -&gt; ApiRequest -&gt; String
</span><a href="Haskemathesis.Execute.Http.html#buildUrl"><span class="hs-identifier hs-var hs-var">buildUrl</span></a></span></span><span> </span><span id="local-6989586621679198645"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679198645"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span id="local-6989586621679198646"><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679198646"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679198647"><span class="hs-identifier hs-var">baseUrl'</span></a></span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679198648"><span class="hs-identifier hs-var">reqPathText</span></a></span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679198649"><span class="hs-identifier hs-var">queryStr</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679198647"><span class="annot"><span class="annottext">baseUrl' :: String
</span><a href="#local-6989586621679198647"><span class="hs-identifier hs-var hs-var">baseUrl'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><a href="#local-6989586621679198650"><span class="hs-identifier hs-var">toString</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679198645"><span class="hs-identifier hs-var">baseUrl</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621679198648"><span class="annot"><span class="annottext">reqPathText :: String
</span><a href="#local-6989586621679198648"><span class="hs-identifier hs-var hs-var">reqPathText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><a href="#local-6989586621679198650"><span class="hs-identifier hs-var">toString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiRequest -&gt; BaseUrl
</span><a href="Haskemathesis.Execute.Types.html#reqPath"><span class="hs-identifier hs-var">reqPath</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679198646"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>    </span><span id="local-6989586621679198649"><span class="annot"><span class="annottext">queryStr :: String
</span><a href="#local-6989586621679198649"><span class="hs-identifier hs-var hs-var">queryStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-113"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679198652"><span class="annot"><span class="annottext">q :: Builder
</span><a href="#local-6989586621679198652"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; QueryText -&gt; Builder
</span><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.URI.html#renderQueryText"><span class="hs-identifier hs-var">renderQueryText</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((BaseUrl, BaseUrl) -&gt; (BaseUrl, Maybe BaseUrl))
-&gt; [(BaseUrl, BaseUrl)] -&gt; QueryText
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(BaseUrl, BaseUrl) -&gt; (BaseUrl, Maybe BaseUrl)
forall {a} {a}. (a, a) -&gt; (a, Maybe a)
</span><a href="#local-6989586621679198653"><span class="hs-identifier hs-var">toQuery</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiRequest -&gt; [(BaseUrl, BaseUrl)]
</span><a href="Haskemathesis.Execute.Types.html#reqQueryParams"><span class="hs-identifier hs-var">reqQueryParams</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679198646"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>            </span><span id="local-6989586621679198655"><span class="annot"><span class="annottext">qText :: BaseUrl
</span><a href="#local-6989586621679198655"><span class="hs-identifier hs-var hs-var">qText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BaseUrl
</span><span class="hs-identifier hs-var">decodeUtf8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">LBS.toStrict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Builder -&gt; ByteString
</span><span class="hs-identifier hs-var">toLazyByteString</span></span><span> </span><span class="annot"><span class="annottext">Builder
</span><a href="#local-6989586621679198652"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; Bool
</span><span class="hs-identifier hs-var">T.null</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679198655"><span class="hs-identifier hs-var">qText</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679198655"><span class="hs-identifier hs-var">qText</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679198653"><span class="annot"><span class="annottext">toQuery :: (a, a) -&gt; (a, Maybe a)
</span><a href="#local-6989586621679198653"><span class="hs-identifier hs-var hs-var">toQuery</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679198658"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679198658"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679198659"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679198659"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679198658"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679198659"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>    </span><span id="local-6989586621679198650"><span class="annot"><span class="annottext">toString :: BaseUrl -&gt; String
</span><a href="#local-6989586621679198650"><span class="hs-identifier hs-var hs-var">toString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BaseUrl -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><a href="Haskemathesis.Execute.Http.html#requestBodyFrom"><span class="hs-identifier hs-type">requestBodyFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiRequest"><span class="hs-identifier hs-type">ApiRequest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#RequestBody"><span class="hs-identifier hs-type">RequestBody</span></a></span><span>
</span><span id="line-120"></span><span id="requestBodyFrom"><span class="annot"><span class="annottext">requestBodyFrom :: ApiRequest -&gt; RequestBody
</span><a href="Haskemathesis.Execute.Http.html#requestBodyFrom"><span class="hs-identifier hs-var hs-var">requestBodyFrom</span></a></span></span><span> </span><span id="local-6989586621679198660"><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679198660"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiRequest -&gt; Maybe (BaseUrl, ByteString)
</span><a href="Haskemathesis.Execute.Types.html#reqBody"><span class="hs-identifier hs-var">reqBody</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679198660"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><span class="annottext">Maybe (BaseUrl, ByteString)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; RequestBody
</span><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#RequestBodyBS"><span class="hs-identifier hs-var">RequestBodyBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrl
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679198661"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679198661"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; RequestBody
</span><a href="file:///nix/store/bnr86jl784iw2vjhcpn7dxsaycwawf4d-http-client-0.7.19-doc/share/doc/http-client-0.7.19/html/src/Network.HTTP.Client.Types.html#RequestBodyBS"><span class="hs-identifier hs-var">RequestBodyBS</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679198661"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-124"></span></pre></body></html>