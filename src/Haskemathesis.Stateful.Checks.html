<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE StrictData #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="annot"><span class="hs-comment">{- | Stateful checks for API testing.

This module provides checks that verify stateful API behavior, including:

* __Use-after-free detection__: Verifies deleted resources return 404
* __Resource availability__: Verifies created resources are accessible
* __Modification persistence__: Verifies PUT/PATCH changes persist

Unlike regular checks that examine a single request/response pair,
stateful checks examine the accumulated test state and may trigger
additional API calls to verify assertions.

=== Example

@
import Haskemathesis.Stateful.Checks
import Haskemathesis.Stateful.Types

-- After running a CRUD sequence
let checks = [useAfterFree, ensureResourceAvailability]
results &lt;- runStatefulChecks executor ops state checks
case results of
    [] -&gt; putStrLn &quot;All stateful checks passed&quot;
    failures -&gt; mapM_ printFailure failures
@

=== Check Types

Stateful checks return 'StatefulCheckResult' which captures:

* Which check was run
* The resource being verified
* The verification request/response
* Success or failure with details
-}</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html"><span class="hs-identifier">Haskemathesis.Stateful.Checks</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Stateful Check Type</span></span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier">StatefulCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier">StatefulCheckResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulFailure"><span class="hs-identifier">StatefulFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Built-in Checks</span></span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#useAfterFree"><span class="hs-identifier">useAfterFree</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#ensureResourceAvailability"><span class="hs-identifier">ensureResourceAvailability</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#ensureModificationPersisted"><span class="hs-identifier">ensureModificationPersisted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Running Checks</span></span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#runStatefulChecks"><span class="hs-identifier">runStatefulChecks</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#runStatefulCheck"><span class="hs-identifier">runStatefulCheck</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Helpers</span></span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#buildResourceRequest"><span class="hs-identifier">buildResourceRequest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#findDeletedResources"><span class="hs-identifier">findDeletedResources</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#findCreatedResources"><span class="hs-identifier">findCreatedResources</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#findModifiedResources"><span class="hs-identifier">findModifiedResources</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html"><span class="hs-identifier">Data.Aeson.KeyMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KM</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isDigit</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/hwr0895a4mk8gp1c52mqxqwygppa2imi-scientific-0.3.8.0-doc/share/doc/scientific-0.3.8.0/html/src/Data.Scientific.html"><span class="hs-identifier">Data.Scientific</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Scientific</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Read</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html"><span class="hs-identifier">Haskemathesis.Execute.Types</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiRequest"><span class="hs-identifier">ApiRequest</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiResponse"><span class="hs-identifier">ApiResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ExecutorWithTimeout"><span class="hs-identifier">ExecutorWithTimeout</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html"><span class="hs-identifier">Haskemathesis.OpenApi.Types</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier">ResolvedOperation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html"><span class="hs-identifier">Haskemathesis.Stateful.Types</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier">ResourceRef</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#TestState"><span class="hs-identifier">TestState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.html"><span class="hs-identifier">Network.HTTP.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.Method.html#methodGet"><span class="hs-identifier">methodGet</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">{- | A stateful check that verifies API behavior across operations.

Unlike regular checks that examine a single request/response,
stateful checks examine the accumulated test state and may
execute additional requests to verify assertions.

=== Fields

* 'scName' - Human-readable name for reporting
* 'scRun' - Function that runs the check, given an executor,
  available operations, and current test state
-}</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">data</span><span> </span><span id="StatefulCheck"><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier hs-var">StatefulCheck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StatefulCheck"><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier hs-var">StatefulCheck</span></a></span></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="scName"><span class="annot"><span class="annottext">StatefulCheck -&gt; Text
</span><a href="Haskemathesis.Stateful.Checks.html#scName"><span class="hs-identifier hs-var hs-var">scName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Human-readable name of the check</span></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="scRun"><span class="annot"><span class="annottext">StatefulCheck
-&gt; ExecutorWithTimeout
-&gt; [ResolvedOperation]
-&gt; TestState
-&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#scRun"><span class="hs-identifier hs-var hs-var">scRun</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-104"></span><span>        </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ExecutorWithTimeout"><span class="hs-identifier hs-type">ExecutorWithTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-105"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#TestState"><span class="hs-identifier hs-type">TestState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier hs-type">StatefulCheckResult</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Function that performs the check</span></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><span class="hs-comment">{- | Result of running a stateful check.

Captures whether the check passed or failed, along with
context about which resource was being verified.
-}</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">data</span><span> </span><span id="StatefulCheckResult"><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier hs-var">StatefulCheckResult</span></a></span></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="StatefulCheckPassed"><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckPassed"><span class="hs-identifier hs-var">StatefulCheckPassed</span></a></span></span><span>
</span><span id="line-118"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="scrCheckName"><span class="annot"><span class="annottext">StatefulCheckResult -&gt; Text
</span><a href="Haskemathesis.Stateful.Checks.html#scrCheckName"><span class="hs-identifier hs-var hs-var">scrCheckName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Name of the check that passed</span></span><span>
</span><span id="line-120"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="scrResource"><span class="annot"><span class="annottext">StatefulCheckResult -&gt; Maybe ResourceRef
</span><a href="Haskemathesis.Stateful.Checks.html#scrResource"><span class="hs-identifier hs-var hs-var">scrResource</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Resource that was verified (if applicable)</span></span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="StatefulCheckFailed"><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckFailed"><span class="hs-identifier hs-var">StatefulCheckFailed</span></a></span></span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulFailure"><span class="hs-identifier hs-type">StatefulFailure</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679242293"><span id="local-6989586621679242305"><span class="annot"><span class="annottext">StatefulCheckResult -&gt; StatefulCheckResult -&gt; Bool
(StatefulCheckResult -&gt; StatefulCheckResult -&gt; Bool)
-&gt; (StatefulCheckResult -&gt; StatefulCheckResult -&gt; Bool)
-&gt; Eq StatefulCheckResult
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: StatefulCheckResult -&gt; StatefulCheckResult -&gt; Bool
== :: StatefulCheckResult -&gt; StatefulCheckResult -&gt; Bool
$c/= :: StatefulCheckResult -&gt; StatefulCheckResult -&gt; Bool
/= :: StatefulCheckResult -&gt; StatefulCheckResult -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242311"><span id="local-6989586621679242322"><span id="local-6989586621679242326"><span class="annot"><span class="annottext">Int -&gt; StatefulCheckResult -&gt; ShowS
[StatefulCheckResult] -&gt; ShowS
StatefulCheckResult -&gt; String
(Int -&gt; StatefulCheckResult -&gt; ShowS)
-&gt; (StatefulCheckResult -&gt; String)
-&gt; ([StatefulCheckResult] -&gt; ShowS)
-&gt; Show StatefulCheckResult
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; StatefulCheckResult -&gt; ShowS
showsPrec :: Int -&gt; StatefulCheckResult -&gt; ShowS
$cshow :: StatefulCheckResult -&gt; String
show :: StatefulCheckResult -&gt; String
$cshowList :: [StatefulCheckResult] -&gt; ShowS
showList :: [StatefulCheckResult] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="annot"><span class="hs-comment">{- | Details of a stateful check failure.

Provides comprehensive information for debugging and reporting,
including the verification request/response and expected behavior.
-}</span></span><span>
</span><span id="line-131"></span><span class="hs-keyword">data</span><span> </span><span id="StatefulFailure"><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulFailure"><span class="hs-identifier hs-var">StatefulFailure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StatefulFailure"><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulFailure"><span class="hs-identifier hs-var">StatefulFailure</span></a></span></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="sfCheckName"><span class="annot"><span class="annottext">StatefulFailure -&gt; Text
</span><a href="Haskemathesis.Stateful.Checks.html#sfCheckName"><span class="hs-identifier hs-var hs-var">sfCheckName</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Name of the check that failed</span></span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sfMessage"><span class="annot"><span class="annottext">StatefulFailure -&gt; Text
</span><a href="Haskemathesis.Stateful.Checks.html#sfMessage"><span class="hs-identifier hs-var hs-var">sfMessage</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Human-readable description of failure</span></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sfResource"><span class="annot"><span class="annottext">StatefulFailure -&gt; ResourceRef
</span><a href="Haskemathesis.Stateful.Checks.html#sfResource"><span class="hs-identifier hs-var hs-var">sfResource</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Resource that failed verification</span></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sfVerificationRequest"><span class="annot"><span class="annottext">StatefulFailure -&gt; Maybe ApiRequest
</span><a href="Haskemathesis.Stateful.Checks.html#sfVerificationRequest"><span class="hs-identifier hs-var hs-var">sfVerificationRequest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiRequest"><span class="hs-identifier hs-type">ApiRequest</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Request sent to verify the assertion</span></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sfVerificationResponse"><span class="annot"><span class="annottext">StatefulFailure -&gt; Maybe ApiResponse
</span><a href="Haskemathesis.Stateful.Checks.html#sfVerificationResponse"><span class="hs-identifier hs-var hs-var">sfVerificationResponse</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiResponse"><span class="hs-identifier hs-type">ApiResponse</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Response received during verification</span></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sfExpectedStatus"><span class="annot"><span class="annottext">StatefulFailure -&gt; Maybe Int
</span><a href="Haskemathesis.Stateful.Checks.html#sfExpectedStatus"><span class="hs-identifier hs-var hs-var">sfExpectedStatus</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Expected HTTP status code</span></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="sfActualStatus"><span class="annot"><span class="annottext">StatefulFailure -&gt; Maybe Int
</span><a href="Haskemathesis.Stateful.Checks.html#sfActualStatus"><span class="hs-identifier hs-var hs-var">sfActualStatus</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Actual HTTP status code received</span></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679242340"><span id="local-6989586621679242351"><span class="annot"><span class="annottext">StatefulFailure -&gt; StatefulFailure -&gt; Bool
(StatefulFailure -&gt; StatefulFailure -&gt; Bool)
-&gt; (StatefulFailure -&gt; StatefulFailure -&gt; Bool)
-&gt; Eq StatefulFailure
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: StatefulFailure -&gt; StatefulFailure -&gt; Bool
== :: StatefulFailure -&gt; StatefulFailure -&gt; Bool
$c/= :: StatefulFailure -&gt; StatefulFailure -&gt; Bool
/= :: StatefulFailure -&gt; StatefulFailure -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242356"><span id="local-6989586621679242368"><span id="local-6989586621679242371"><span class="annot"><span class="annottext">Int -&gt; StatefulFailure -&gt; ShowS
[StatefulFailure] -&gt; ShowS
StatefulFailure -&gt; String
(Int -&gt; StatefulFailure -&gt; ShowS)
-&gt; (StatefulFailure -&gt; String)
-&gt; ([StatefulFailure] -&gt; ShowS)
-&gt; Show StatefulFailure
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; StatefulFailure -&gt; ShowS
showsPrec :: Int -&gt; StatefulFailure -&gt; ShowS
$cshow :: StatefulFailure -&gt; String
show :: StatefulFailure -&gt; String
$cshowList :: [StatefulFailure] -&gt; ShowS
showList :: [StatefulFailure] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><span class="hs-comment">{- | Check that deleted resources return 404.

This check detects &quot;use-after-free&quot; bugs where:

1. A resource is created (POST /resources)
2. The resource is deleted (DELETE /resources/{id})
3. Attempting to access the resource should return 404

=== How It Works

1. Finds all DELETE operations in the test history
2. For each deleted resource, builds a GET request
3. Executes the GET request
4. Verifies the response is 404 Not Found

=== Example Failure

@
UseAfterFree Check Failed:
  Resource: /users/42
  Expected: 404 Not Found
  Actual: 200 OK (resource still accessible after DELETE)
@
-}</span></span><span>
</span><span id="line-173"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#useAfterFree"><span class="hs-identifier hs-type">useAfterFree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier hs-type">StatefulCheck</span></a></span><span>
</span><span id="line-174"></span><span id="useAfterFree"><span class="annot"><span class="annottext">useAfterFree :: StatefulCheck
</span><a href="Haskemathesis.Stateful.Checks.html#useAfterFree"><span class="hs-identifier hs-var hs-var">useAfterFree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier hs-type">StatefulCheck</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scName :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#scName"><span class="hs-identifier hs-var">scName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;use-after-free&quot;</span></span><span>
</span><span id="line-177"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scRun :: ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; TestState -&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#scRun"><span class="hs-identifier hs-var">scRun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; TestState -&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#runUseAfterFree"><span class="hs-identifier hs-var">runUseAfterFree</span></a></span><span>
</span><span id="line-178"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#runUseAfterFree"><span class="hs-identifier hs-type">runUseAfterFree</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ExecutorWithTimeout"><span class="hs-identifier hs-type">ExecutorWithTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#TestState"><span class="hs-identifier hs-type">TestState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier hs-type">StatefulCheckResult</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-185"></span><span id="runUseAfterFree"><span class="annot"><span class="annottext">runUseAfterFree :: ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; TestState -&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#runUseAfterFree"><span class="hs-identifier hs-var hs-var">runUseAfterFree</span></a></span></span><span> </span><span id="local-6989586621679242376"><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242376"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span id="local-6989586621679242377"><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242377"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621679242378"><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242378"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">(ResourceRef -&gt; IO StatefulCheckResult)
-&gt; [ResourceRef] -&gt; IO [StatefulCheckResult]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; ResourceRef -&gt; IO StatefulCheckResult
</span><a href="Haskemathesis.Stateful.Checks.html#checkDeletedResource"><span class="hs-identifier hs-var">checkDeletedResource</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242376"><span class="hs-identifier hs-var">executor</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242377"><span class="hs-identifier hs-var">ops</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestState -&gt; [ResourceRef]
</span><a href="Haskemathesis.Stateful.Checks.html#findDeletedResources"><span class="hs-identifier hs-var">findDeletedResources</span></a></span><span> </span><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242378"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#checkDeletedResource"><span class="hs-identifier hs-type">checkDeletedResource</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ExecutorWithTimeout"><span class="hs-identifier hs-type">ExecutorWithTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier hs-type">StatefulCheckResult</span></a></span><span>
</span><span id="line-193"></span><span id="checkDeletedResource"><span class="annot"><span class="annottext">checkDeletedResource :: ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; ResourceRef -&gt; IO StatefulCheckResult
</span><a href="Haskemathesis.Stateful.Checks.html#checkDeletedResource"><span class="hs-identifier hs-var hs-var">checkDeletedResource</span></a></span></span><span> </span><span id="local-6989586621679242381"><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242381"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span id="local-6989586621679242382"><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242382"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621679242383"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242383"><span class="hs-identifier hs-var">resource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation] -&gt; ResourceRef -&gt; Maybe ResolvedOperation
</span><a href="Haskemathesis.Stateful.Checks.html#findGetOperation"><span class="hs-identifier hs-var">findGetOperation</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242382"><span class="hs-identifier hs-var">ops</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242383"><span class="hs-identifier hs-var">resource</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-195"></span><span>        </span><span class="annot"><span class="annottext">Maybe ResolvedOperation
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-196"></span><span>            </span><span class="hs-comment">-- No GET operation available, skip check</span><span>
</span><span id="line-197"></span><span>            </span><span class="annot"><span class="annottext">StatefulCheckResult -&gt; IO StatefulCheckResult
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(StatefulCheckResult -&gt; IO StatefulCheckResult)
-&gt; StatefulCheckResult -&gt; IO StatefulCheckResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-198"></span><span>                </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckPassed"><span class="hs-identifier hs-type">StatefulCheckPassed</span></a></span><span>
</span><span id="line-199"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scrCheckName :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#scrCheckName"><span class="hs-identifier hs-var">scrCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;use-after-free&quot;</span></span><span>
</span><span id="line-200"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scrResource :: Maybe ResourceRef
</span><a href="Haskemathesis.Stateful.Checks.html#scrResource"><span class="hs-identifier hs-var">scrResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceRef -&gt; Maybe ResourceRef
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242383"><span class="hs-identifier hs-var">resource</span></a></span><span>
</span><span id="line-201"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679242385"><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242385"><span class="hs-identifier hs-var">getOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679242386"><span class="annot"><span class="annottext">req :: ApiRequest
</span><a href="#local-6989586621679242386"><span class="hs-identifier hs-var hs-var hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResolvedOperation -&gt; ResourceRef -&gt; ApiRequest
</span><a href="Haskemathesis.Stateful.Checks.html#buildResourceRequest"><span class="hs-identifier hs-var">buildResourceRequest</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242385"><span class="hs-identifier hs-var">getOp</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242383"><span class="hs-identifier hs-var">resource</span></a></span><span>
</span><span id="line-204"></span><span>            </span><span id="local-6989586621679242387"><span class="annot"><a href="#local-6989586621679242387"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242381"><span class="hs-identifier hs-var">executor</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242386"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-205"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679242388"><span class="annot"><a href="#local-6989586621679242388"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiResponse -&gt; Int
</span><a href="Haskemathesis.Execute.Types.html#resStatusCode"><span class="hs-identifier hs-var">resStatusCode</span></a></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242387"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-206"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679242388"><span class="hs-identifier hs-type">status</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">404</span></span><span>
</span><span id="line-207"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-208"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-209"></span><span>                        </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckPassed"><span class="hs-identifier hs-type">StatefulCheckPassed</span></a></span><span>
</span><span id="line-210"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#scrCheckName"><span class="hs-identifier hs-var">scrCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;use-after-free&quot;</span></span><span>
</span><span id="line-211"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#scrResource"><span class="hs-identifier hs-var">scrResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242383"><span class="hs-identifier hs-type">resource</span></a></span><span>
</span><span id="line-212"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-213"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-214"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-215"></span><span>                        </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckFailed"><span class="hs-identifier hs-type">StatefulCheckFailed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-216"></span><span>                            </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulFailure"><span class="hs-identifier hs-type">StatefulFailure</span></a></span><span>
</span><span id="line-217"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfCheckName"><span class="hs-identifier hs-var">sfCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;use-after-free&quot;</span></span><span>
</span><span id="line-218"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfMessage"><span class="hs-identifier hs-var">sfMessage</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>                                    </span><span class="annot"><span class="hs-string">&quot;Deleted resource is still accessible. &quot;</span></span><span>
</span><span id="line-220"></span><span>                                        </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Expected 404, got &quot;</span></span><span>
</span><span id="line-221"></span><span>                                        </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621679242388"><span class="hs-identifier hs-type">status</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfResource"><span class="hs-identifier hs-var">sfResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679242383"><span class="hs-identifier hs-type">resource</span></a></span><span>
</span><span id="line-223"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfVerificationRequest"><span class="hs-identifier hs-var">sfVerificationRequest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242386"><span class="hs-identifier hs-type">req</span></a></span><span>
</span><span id="line-224"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfVerificationResponse"><span class="hs-identifier hs-var">sfVerificationResponse</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242387"><span class="hs-identifier hs-type">response</span></a></span><span>
</span><span id="line-225"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfExpectedStatus"><span class="hs-identifier hs-var">sfExpectedStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-number">404</span></span><span>
</span><span id="line-226"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfActualStatus"><span class="hs-identifier hs-var">sfActualStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242388"><span class="hs-identifier hs-type">status</span></a></span><span>
</span><span id="line-227"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><span class="hs-comment">{- | Check that created resources are immediately accessible.

This check verifies that resources created via POST are available
for retrieval via GET.

=== How It Works

1. Finds all POST operations that created resources
2. For each created resource, builds a GET request
3. Executes the GET request
4. Verifies the response is 200 OK

=== Note

This check excludes resources that were subsequently deleted.
-}</span></span><span>
</span><span id="line-245"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#ensureResourceAvailability"><span class="hs-identifier hs-type">ensureResourceAvailability</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier hs-type">StatefulCheck</span></a></span><span>
</span><span id="line-246"></span><span id="ensureResourceAvailability"><span class="annot"><span class="annottext">ensureResourceAvailability :: StatefulCheck
</span><a href="Haskemathesis.Stateful.Checks.html#ensureResourceAvailability"><span class="hs-identifier hs-var hs-var">ensureResourceAvailability</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier hs-type">StatefulCheck</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scName :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#scName"><span class="hs-identifier hs-var">scName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ensure-resource-availability&quot;</span></span><span>
</span><span id="line-249"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scRun :: ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; TestState -&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#scRun"><span class="hs-identifier hs-var">scRun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; TestState -&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#runEnsureResourceAvailability"><span class="hs-identifier hs-var">runEnsureResourceAvailability</span></a></span><span>
</span><span id="line-250"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#runEnsureResourceAvailability"><span class="hs-identifier hs-type">runEnsureResourceAvailability</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ExecutorWithTimeout"><span class="hs-identifier hs-type">ExecutorWithTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#TestState"><span class="hs-identifier hs-type">TestState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier hs-type">StatefulCheckResult</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-257"></span><span id="runEnsureResourceAvailability"><span class="annot"><span class="annottext">runEnsureResourceAvailability :: ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; TestState -&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#runEnsureResourceAvailability"><span class="hs-identifier hs-var hs-var">runEnsureResourceAvailability</span></a></span></span><span> </span><span id="local-6989586621679242393"><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242393"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span id="local-6989586621679242394"><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242394"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621679242395"><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242395"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="annottext">(ResourceRef -&gt; IO StatefulCheckResult)
-&gt; [ResourceRef] -&gt; IO [StatefulCheckResult]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; ResourceRef -&gt; IO StatefulCheckResult
</span><a href="Haskemathesis.Stateful.Checks.html#checkResourceAvailable"><span class="hs-identifier hs-var">checkResourceAvailable</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242393"><span class="hs-identifier hs-var">executor</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242394"><span class="hs-identifier hs-var">ops</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ResourceRef]
</span><a href="#local-6989586621679242397"><span class="hs-identifier hs-var">activeResources</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621679242398"><span class="annot"><span class="annottext">createdResources :: [ResourceRef]
</span><a href="#local-6989586621679242398"><span class="hs-identifier hs-var hs-var">createdResources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestState -&gt; [ResourceRef]
</span><a href="Haskemathesis.Stateful.Checks.html#findCreatedResources"><span class="hs-identifier hs-var">findCreatedResources</span></a></span><span> </span><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242395"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621679242399"><span class="annot"><span class="annottext">deletedResources :: [ResourceRef]
</span><a href="#local-6989586621679242399"><span class="hs-identifier hs-var hs-var">deletedResources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestState -&gt; [ResourceRef]
</span><a href="Haskemathesis.Stateful.Checks.html#findDeletedResources"><span class="hs-identifier hs-var">findDeletedResources</span></a></span><span> </span><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242395"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-comment">-- Exclude resources that were deleted</span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621679242397"><span class="annot"><span class="annottext">activeResources :: [ResourceRef]
</span><a href="#local-6989586621679242397"><span class="hs-identifier hs-var hs-var">activeResources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ResourceRef -&gt; Bool) -&gt; [ResourceRef] -&gt; [ResourceRef]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ResourceRef] -&gt; ResourceRef -&gt; Bool
forall {t :: * -&gt; *}.
Foldable t =&gt;
t ResourceRef -&gt; ResourceRef -&gt; Bool
</span><a href="#local-6989586621679242401"><span class="hs-identifier hs-var">notDeleted</span></a></span><span> </span><span class="annot"><span class="annottext">[ResourceRef]
</span><a href="#local-6989586621679242399"><span class="hs-identifier hs-var">deletedResources</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ResourceRef]
</span><a href="#local-6989586621679242398"><span class="hs-identifier hs-var">createdResources</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621679242401"><span class="annot"><span class="annottext">notDeleted :: t ResourceRef -&gt; ResourceRef -&gt; Bool
</span><a href="#local-6989586621679242401"><span class="hs-identifier hs-var hs-var">notDeleted</span></a></span></span><span> </span><span id="local-6989586621679242404"><span class="annot"><span class="annottext">t ResourceRef
</span><a href="#local-6989586621679242404"><span class="hs-identifier hs-var">deleted</span></a></span></span><span> </span><span id="local-6989586621679242405"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242405"><span class="hs-identifier hs-var">resource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-265"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ResourceRef -&gt; Bool) -&gt; t ResourceRef -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResourceRef -&gt; ResourceRef -&gt; Bool
</span><a href="#local-6989586621679242408"><span class="hs-identifier hs-var">sameResource</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242405"><span class="hs-identifier hs-var">resource</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t ResourceRef
</span><a href="#local-6989586621679242404"><span class="hs-identifier hs-var">deleted</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span id="local-6989586621679242408"><span class="annot"><span class="annottext">sameResource :: ResourceRef -&gt; ResourceRef -&gt; Bool
</span><a href="#local-6989586621679242408"><span class="hs-identifier hs-var hs-var">sameResource</span></a></span></span><span> </span><span id="local-6989586621679242413"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242413"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621679242414"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242414"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-267"></span><span>        </span><span class="annot"><span class="annottext">ResourceRef -&gt; Text
</span><a href="Haskemathesis.Stateful.Types.html#rrResourcePath"><span class="hs-identifier hs-var">rrResourcePath</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242413"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ResourceRef -&gt; Text
</span><a href="Haskemathesis.Stateful.Types.html#rrResourcePath"><span class="hs-identifier hs-var">rrResourcePath</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242414"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-268"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ResourceRef -&gt; Map Text Value
</span><a href="Haskemathesis.Stateful.Types.html#rrIdentifiers"><span class="hs-identifier hs-var">rrIdentifiers</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242413"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Value -&gt; Map Text Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ResourceRef -&gt; Map Text Value
</span><a href="Haskemathesis.Stateful.Types.html#rrIdentifiers"><span class="hs-identifier hs-var">rrIdentifiers</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242414"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#checkResourceAvailable"><span class="hs-identifier hs-type">checkResourceAvailable</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ExecutorWithTimeout"><span class="hs-identifier hs-type">ExecutorWithTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier hs-type">StatefulCheckResult</span></a></span><span>
</span><span id="line-275"></span><span id="checkResourceAvailable"><span class="annot"><span class="annottext">checkResourceAvailable :: ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; ResourceRef -&gt; IO StatefulCheckResult
</span><a href="Haskemathesis.Stateful.Checks.html#checkResourceAvailable"><span class="hs-identifier hs-var hs-var">checkResourceAvailable</span></a></span></span><span> </span><span id="local-6989586621679242418"><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242418"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span id="local-6989586621679242419"><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242419"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621679242420"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242420"><span class="hs-identifier hs-var">resource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation] -&gt; ResourceRef -&gt; Maybe ResolvedOperation
</span><a href="Haskemathesis.Stateful.Checks.html#findGetOperation"><span class="hs-identifier hs-var">findGetOperation</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242419"><span class="hs-identifier hs-var">ops</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242420"><span class="hs-identifier hs-var">resource</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">Maybe ResolvedOperation
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-278"></span><span>            </span><span class="hs-comment">-- No GET operation available, skip check</span><span>
</span><span id="line-279"></span><span>            </span><span class="annot"><span class="annottext">StatefulCheckResult -&gt; IO StatefulCheckResult
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(StatefulCheckResult -&gt; IO StatefulCheckResult)
-&gt; StatefulCheckResult -&gt; IO StatefulCheckResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-280"></span><span>                </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckPassed"><span class="hs-identifier hs-type">StatefulCheckPassed</span></a></span><span>
</span><span id="line-281"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scrCheckName :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#scrCheckName"><span class="hs-identifier hs-var">scrCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ensure-resource-availability&quot;</span></span><span>
</span><span id="line-282"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scrResource :: Maybe ResourceRef
</span><a href="Haskemathesis.Stateful.Checks.html#scrResource"><span class="hs-identifier hs-var">scrResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceRef -&gt; Maybe ResourceRef
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242420"><span class="hs-identifier hs-var">resource</span></a></span><span>
</span><span id="line-283"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-284"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679242421"><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242421"><span class="hs-identifier hs-var">getOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679242422"><span class="annot"><span class="annottext">req :: ApiRequest
</span><a href="#local-6989586621679242422"><span class="hs-identifier hs-var hs-var hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResolvedOperation -&gt; ResourceRef -&gt; ApiRequest
</span><a href="Haskemathesis.Stateful.Checks.html#buildResourceRequest"><span class="hs-identifier hs-var">buildResourceRequest</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242421"><span class="hs-identifier hs-var">getOp</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242420"><span class="hs-identifier hs-var">resource</span></a></span><span>
</span><span id="line-286"></span><span>            </span><span id="local-6989586621679242423"><span class="annot"><a href="#local-6989586621679242423"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242418"><span class="hs-identifier hs-var">executor</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242422"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-287"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679242424"><span class="annot"><a href="#local-6989586621679242424"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiResponse -&gt; Int
</span><a href="Haskemathesis.Execute.Types.html#resStatusCode"><span class="hs-identifier hs-var">resStatusCode</span></a></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242423"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-288"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679242424"><span class="hs-identifier hs-type">status</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;=</span></span><span> </span><span class="annot"><span class="hs-number">200</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621679242424"><span class="hs-identifier hs-type">status</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;</span></span><span> </span><span class="annot"><span class="hs-number">300</span></span><span>
</span><span id="line-289"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-290"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-291"></span><span>                        </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckPassed"><span class="hs-identifier hs-type">StatefulCheckPassed</span></a></span><span>
</span><span id="line-292"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#scrCheckName"><span class="hs-identifier hs-var">scrCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;ensure-resource-availability&quot;</span></span><span>
</span><span id="line-293"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#scrResource"><span class="hs-identifier hs-var">scrResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242420"><span class="hs-identifier hs-type">resource</span></a></span><span>
</span><span id="line-294"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-296"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-297"></span><span>                        </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckFailed"><span class="hs-identifier hs-type">StatefulCheckFailed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-298"></span><span>                            </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulFailure"><span class="hs-identifier hs-type">StatefulFailure</span></a></span><span>
</span><span id="line-299"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfCheckName"><span class="hs-identifier hs-var">sfCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;ensure-resource-availability&quot;</span></span><span>
</span><span id="line-300"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfMessage"><span class="hs-identifier hs-var">sfMessage</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>                                    </span><span class="annot"><span class="hs-string">&quot;Created resource is not accessible. &quot;</span></span><span>
</span><span id="line-302"></span><span>                                        </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Expected 2xx, got &quot;</span></span><span>
</span><span id="line-303"></span><span>                                        </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621679242424"><span class="hs-identifier hs-type">status</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfResource"><span class="hs-identifier hs-var">sfResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679242420"><span class="hs-identifier hs-type">resource</span></a></span><span>
</span><span id="line-305"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfVerificationRequest"><span class="hs-identifier hs-var">sfVerificationRequest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242422"><span class="hs-identifier hs-type">req</span></a></span><span>
</span><span id="line-306"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfVerificationResponse"><span class="hs-identifier hs-var">sfVerificationResponse</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242423"><span class="hs-identifier hs-type">response</span></a></span><span>
</span><span id="line-307"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfExpectedStatus"><span class="hs-identifier hs-var">sfExpectedStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-number">200</span></span><span>
</span><span id="line-308"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfActualStatus"><span class="hs-identifier hs-var">sfActualStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242424"><span class="hs-identifier hs-type">status</span></a></span><span>
</span><span id="line-309"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="annot"><span class="hs-comment">{- | Check that modifications (PUT/PATCH) are persisted.

This check verifies that changes made via PUT or PATCH are
reflected in subsequent GET requests.

=== How It Works

1. Finds all PUT/PATCH operations in the history
2. For each modified resource, retrieves the modification data
3. Executes a GET request
4. Verifies the response body contains the modified values

=== Limitations

Currently performs a simple presence check on top-level fields.
Does not verify nested objects or arrays in detail.
-}</span></span><span>
</span><span id="line-328"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#ensureModificationPersisted"><span class="hs-identifier hs-type">ensureModificationPersisted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier hs-type">StatefulCheck</span></a></span><span>
</span><span id="line-329"></span><span id="ensureModificationPersisted"><span class="annot"><span class="annottext">ensureModificationPersisted :: StatefulCheck
</span><a href="Haskemathesis.Stateful.Checks.html#ensureModificationPersisted"><span class="hs-identifier hs-var hs-var">ensureModificationPersisted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-330"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier hs-type">StatefulCheck</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scName :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#scName"><span class="hs-identifier hs-var">scName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ensure-modification-persisted&quot;</span></span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scRun :: ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; TestState -&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#scRun"><span class="hs-identifier hs-var">scRun</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; TestState -&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#runEnsureModificationPersisted"><span class="hs-identifier hs-var">runEnsureModificationPersisted</span></a></span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#runEnsureModificationPersisted"><span class="hs-identifier hs-type">runEnsureModificationPersisted</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ExecutorWithTimeout"><span class="hs-identifier hs-type">ExecutorWithTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-338"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#TestState"><span class="hs-identifier hs-type">TestState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier hs-type">StatefulCheckResult</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-340"></span><span id="runEnsureModificationPersisted"><span class="annot"><span class="annottext">runEnsureModificationPersisted :: ExecutorWithTimeout
-&gt; [ResolvedOperation] -&gt; TestState -&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#runEnsureModificationPersisted"><span class="hs-identifier hs-var hs-var">runEnsureModificationPersisted</span></a></span></span><span> </span><span id="local-6989586621679242427"><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242427"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span id="local-6989586621679242428"><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242428"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621679242429"><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242429"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><span class="annottext">((ResourceRef, Value) -&gt; IO StatefulCheckResult)
-&gt; [(ResourceRef, Value)] -&gt; IO [StatefulCheckResult]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExecutorWithTimeout
-&gt; [ResolvedOperation]
-&gt; (ResourceRef, Value)
-&gt; IO StatefulCheckResult
</span><a href="Haskemathesis.Stateful.Checks.html#checkModificationPersisted"><span class="hs-identifier hs-var">checkModificationPersisted</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242427"><span class="hs-identifier hs-var">executor</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242428"><span class="hs-identifier hs-var">ops</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ResourceRef, Value)]
</span><a href="#local-6989586621679242431"><span class="hs-identifier hs-var">activeModifications</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-343"></span><span>    </span><span id="local-6989586621679242432"><span class="annot"><span class="annottext">modifications :: [(ResourceRef, Value)]
</span><a href="#local-6989586621679242432"><span class="hs-identifier hs-var hs-var">modifications</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestState -&gt; [(ResourceRef, Value)]
</span><a href="Haskemathesis.Stateful.Checks.html#findModifiedResources"><span class="hs-identifier hs-var">findModifiedResources</span></a></span><span> </span><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242429"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-344"></span><span>    </span><span id="local-6989586621679242433"><span class="annot"><span class="annottext">deletedResources :: [ResourceRef]
</span><a href="#local-6989586621679242433"><span class="hs-identifier hs-var hs-var">deletedResources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestState -&gt; [ResourceRef]
</span><a href="Haskemathesis.Stateful.Checks.html#findDeletedResources"><span class="hs-identifier hs-var">findDeletedResources</span></a></span><span> </span><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242429"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">-- Exclude resources that were deleted after modification</span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621679242431"><span class="annot"><span class="annottext">activeModifications :: [(ResourceRef, Value)]
</span><a href="#local-6989586621679242431"><span class="hs-identifier hs-var hs-var">activeModifications</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ResourceRef, Value) -&gt; Bool)
-&gt; [(ResourceRef, Value)] -&gt; [(ResourceRef, Value)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ResourceRef] -&gt; ResourceRef -&gt; Bool
forall {t :: * -&gt; *}.
Foldable t =&gt;
t ResourceRef -&gt; ResourceRef -&gt; Bool
</span><a href="#local-6989586621679242435"><span class="hs-identifier hs-var">notDeleted</span></a></span><span> </span><span class="annot"><span class="annottext">[ResourceRef]
</span><a href="#local-6989586621679242433"><span class="hs-identifier hs-var">deletedResources</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceRef -&gt; Bool)
-&gt; ((ResourceRef, Value) -&gt; ResourceRef)
-&gt; (ResourceRef, Value)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ResourceRef, Value) -&gt; ResourceRef
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ResourceRef, Value)]
</span><a href="#local-6989586621679242432"><span class="hs-identifier hs-var">modifications</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621679242435"><span class="annot"><span class="annottext">notDeleted :: t ResourceRef -&gt; ResourceRef -&gt; Bool
</span><a href="#local-6989586621679242435"><span class="hs-identifier hs-var hs-var">notDeleted</span></a></span></span><span> </span><span id="local-6989586621679242440"><span class="annot"><span class="annottext">t ResourceRef
</span><a href="#local-6989586621679242440"><span class="hs-identifier hs-var">deleted</span></a></span></span><span> </span><span id="local-6989586621679242441"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242441"><span class="hs-identifier hs-var">resource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ResourceRef -&gt; Bool) -&gt; t ResourceRef -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResourceRef -&gt; ResourceRef -&gt; Bool
</span><a href="#local-6989586621679242442"><span class="hs-identifier hs-var">sameResource</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242441"><span class="hs-identifier hs-var">resource</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t ResourceRef
</span><a href="#local-6989586621679242440"><span class="hs-identifier hs-var">deleted</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span id="local-6989586621679242442"><span class="annot"><span class="annottext">sameResource :: ResourceRef -&gt; ResourceRef -&gt; Bool
</span><a href="#local-6989586621679242442"><span class="hs-identifier hs-var hs-var">sameResource</span></a></span></span><span> </span><span id="local-6989586621679242446"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242446"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621679242447"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242447"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-350"></span><span>        </span><span class="annot"><span class="annottext">ResourceRef -&gt; Text
</span><a href="Haskemathesis.Stateful.Types.html#rrResourcePath"><span class="hs-identifier hs-var">rrResourcePath</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242446"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ResourceRef -&gt; Text
</span><a href="Haskemathesis.Stateful.Types.html#rrResourcePath"><span class="hs-identifier hs-var">rrResourcePath</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242447"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-351"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ResourceRef -&gt; Map Text Value
</span><a href="Haskemathesis.Stateful.Types.html#rrIdentifiers"><span class="hs-identifier hs-var">rrIdentifiers</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242446"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text Value -&gt; Map Text Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ResourceRef -&gt; Map Text Value
</span><a href="Haskemathesis.Stateful.Types.html#rrIdentifiers"><span class="hs-identifier hs-var">rrIdentifiers</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242447"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#checkModificationPersisted"><span class="hs-identifier hs-type">checkModificationPersisted</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ExecutorWithTimeout"><span class="hs-identifier hs-type">ExecutorWithTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-357"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier hs-type">StatefulCheckResult</span></a></span><span>
</span><span id="line-358"></span><span id="checkModificationPersisted"><span class="annot"><span class="annottext">checkModificationPersisted :: ExecutorWithTimeout
-&gt; [ResolvedOperation]
-&gt; (ResourceRef, Value)
-&gt; IO StatefulCheckResult
</span><a href="Haskemathesis.Stateful.Checks.html#checkModificationPersisted"><span class="hs-identifier hs-var hs-var">checkModificationPersisted</span></a></span></span><span> </span><span id="local-6989586621679242448"><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242448"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span id="local-6989586621679242449"><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242449"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679242450"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242450"><span class="hs-identifier hs-var">resource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242451"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242451"><span class="hs-identifier hs-var">expectedData</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation] -&gt; ResourceRef -&gt; Maybe ResolvedOperation
</span><a href="Haskemathesis.Stateful.Checks.html#findGetOperation"><span class="hs-identifier hs-var">findGetOperation</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242449"><span class="hs-identifier hs-var">ops</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242450"><span class="hs-identifier hs-var">resource</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="annottext">Maybe ResolvedOperation
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-361"></span><span>            </span><span class="hs-comment">-- No GET operation available, skip check</span><span>
</span><span id="line-362"></span><span>            </span><span class="annot"><span class="annottext">StatefulCheckResult -&gt; IO StatefulCheckResult
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(StatefulCheckResult -&gt; IO StatefulCheckResult)
-&gt; StatefulCheckResult -&gt; IO StatefulCheckResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-363"></span><span>                </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckPassed"><span class="hs-identifier hs-type">StatefulCheckPassed</span></a></span><span>
</span><span id="line-364"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scrCheckName :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#scrCheckName"><span class="hs-identifier hs-var">scrCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ensure-modification-persisted&quot;</span></span><span>
</span><span id="line-365"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scrResource :: Maybe ResourceRef
</span><a href="Haskemathesis.Stateful.Checks.html#scrResource"><span class="hs-identifier hs-var">scrResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceRef -&gt; Maybe ResourceRef
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242450"><span class="hs-identifier hs-var">resource</span></a></span><span>
</span><span id="line-366"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-367"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679242452"><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242452"><span class="hs-identifier hs-var">getOp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-368"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679242453"><span class="annot"><span class="annottext">req :: ApiRequest
</span><a href="#local-6989586621679242453"><span class="hs-identifier hs-var hs-var hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResolvedOperation -&gt; ResourceRef -&gt; ApiRequest
</span><a href="Haskemathesis.Stateful.Checks.html#buildResourceRequest"><span class="hs-identifier hs-var">buildResourceRequest</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242452"><span class="hs-identifier hs-var">getOp</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242450"><span class="hs-identifier hs-var">resource</span></a></span><span>
</span><span id="line-369"></span><span>            </span><span id="local-6989586621679242454"><span class="annot"><a href="#local-6989586621679242454"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242448"><span class="hs-identifier hs-var">executor</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242453"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-370"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679242455"><span class="annot"><a href="#local-6989586621679242455"><span class="hs-identifier hs-var hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiResponse -&gt; Int
</span><a href="Haskemathesis.Execute.Types.html#resStatusCode"><span class="hs-identifier hs-var">resStatusCode</span></a></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242454"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-371"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679242455"><span class="hs-identifier hs-type">status</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;=</span></span><span> </span><span class="annot"><span class="hs-number">200</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><a href="#local-6989586621679242455"><span class="hs-identifier hs-type">status</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;</span></span><span> </span><span class="annot"><span class="hs-number">300</span></span><span>
</span><span id="line-372"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Decoding.html#decodeStrict"><span class="hs-identifier hs-type">Aeson.decodeStrict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Haskemathesis.Execute.Types.html#resBody"><span class="hs-identifier hs-var">resBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679242454"><span class="hs-identifier hs-type">response</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-373"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-374"></span><span>                        </span><span class="hs-comment">-- Could not parse response body</span><span>
</span><span id="line-375"></span><span>                        </span><span class="annot"><span class="annottext">StatefulCheckResult -&gt; IO StatefulCheckResult
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(StatefulCheckResult -&gt; IO StatefulCheckResult)
-&gt; StatefulCheckResult -&gt; IO StatefulCheckResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-376"></span><span>                            </span><span class="annot"><span class="annottext">StatefulFailure -&gt; StatefulCheckResult
</span><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckFailed"><span class="hs-identifier hs-var">StatefulCheckFailed</span></a></span><span> </span><span class="annot"><span class="annottext">(StatefulFailure -&gt; StatefulCheckResult)
-&gt; StatefulFailure -&gt; StatefulCheckResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-377"></span><span>                                </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulFailure"><span class="hs-identifier hs-type">StatefulFailure</span></a></span><span>
</span><span id="line-378"></span><span>                                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfCheckName :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#sfCheckName"><span class="hs-identifier hs-var">sfCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ensure-modification-persisted&quot;</span></span><span>
</span><span id="line-379"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfMessage :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#sfMessage"><span class="hs-identifier hs-var">sfMessage</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Could not parse response body as JSON&quot;</span></span><span>
</span><span id="line-380"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfResource :: ResourceRef
</span><a href="Haskemathesis.Stateful.Checks.html#sfResource"><span class="hs-identifier hs-var">sfResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242450"><span class="hs-identifier hs-var">resource</span></a></span><span>
</span><span id="line-381"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfVerificationRequest :: Maybe ApiRequest
</span><a href="Haskemathesis.Stateful.Checks.html#sfVerificationRequest"><span class="hs-identifier hs-var">sfVerificationRequest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiRequest -&gt; Maybe ApiRequest
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242453"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-382"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfVerificationResponse :: Maybe ApiResponse
</span><a href="Haskemathesis.Stateful.Checks.html#sfVerificationResponse"><span class="hs-identifier hs-var">sfVerificationResponse</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiResponse -&gt; Maybe ApiResponse
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242454"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-383"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfExpectedStatus :: Maybe Int
</span><a href="Haskemathesis.Stateful.Checks.html#sfExpectedStatus"><span class="hs-identifier hs-var">sfExpectedStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-384"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfActualStatus :: Maybe Int
</span><a href="Haskemathesis.Stateful.Checks.html#sfActualStatus"><span class="hs-identifier hs-var">sfActualStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679242455"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-385"></span><span>                                    </span><span class="hs-special">}</span><span>
</span><span id="line-386"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679242458"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242458"><span class="hs-identifier hs-var">actualData</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-387"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><a href="Haskemathesis.Stateful.Checks.html#containsExpectedFields"><span class="hs-identifier hs-var">containsExpectedFields</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242451"><span class="hs-identifier hs-var">expectedData</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242458"><span class="hs-identifier hs-var">actualData</span></a></span><span>
</span><span id="line-388"></span><span>                            </span><span class="hs-keyword">then</span><span>
</span><span id="line-389"></span><span>                                </span><span class="annot"><span class="annottext">StatefulCheckResult -&gt; IO StatefulCheckResult
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(StatefulCheckResult -&gt; IO StatefulCheckResult)
-&gt; StatefulCheckResult -&gt; IO StatefulCheckResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-390"></span><span>                                    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckPassed"><span class="hs-identifier hs-type">StatefulCheckPassed</span></a></span><span>
</span><span id="line-391"></span><span>                                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">scrCheckName :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#scrCheckName"><span class="hs-identifier hs-var">scrCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ensure-modification-persisted&quot;</span></span><span>
</span><span id="line-392"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">scrResource :: Maybe ResourceRef
</span><a href="Haskemathesis.Stateful.Checks.html#scrResource"><span class="hs-identifier hs-var">scrResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceRef -&gt; Maybe ResourceRef
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242450"><span class="hs-identifier hs-var">resource</span></a></span><span>
</span><span id="line-393"></span><span>                                        </span><span class="hs-special">}</span><span>
</span><span id="line-394"></span><span>                            </span><span class="hs-keyword">else</span><span>
</span><span id="line-395"></span><span>                                </span><span class="annot"><span class="annottext">StatefulCheckResult -&gt; IO StatefulCheckResult
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(StatefulCheckResult -&gt; IO StatefulCheckResult)
-&gt; StatefulCheckResult -&gt; IO StatefulCheckResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-396"></span><span>                                    </span><span class="annot"><span class="annottext">StatefulFailure -&gt; StatefulCheckResult
</span><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckFailed"><span class="hs-identifier hs-var">StatefulCheckFailed</span></a></span><span> </span><span class="annot"><span class="annottext">(StatefulFailure -&gt; StatefulCheckResult)
-&gt; StatefulFailure -&gt; StatefulCheckResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-397"></span><span>                                        </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulFailure"><span class="hs-identifier hs-type">StatefulFailure</span></a></span><span>
</span><span id="line-398"></span><span>                                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sfCheckName :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#sfCheckName"><span class="hs-identifier hs-var">sfCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ensure-modification-persisted&quot;</span></span><span>
</span><span id="line-399"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfMessage :: Text
</span><a href="Haskemathesis.Stateful.Checks.html#sfMessage"><span class="hs-identifier hs-var">sfMessage</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-400"></span><span>                                                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Modified values not found in response&quot;</span></span><span>
</span><span id="line-401"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfResource :: ResourceRef
</span><a href="Haskemathesis.Stateful.Checks.html#sfResource"><span class="hs-identifier hs-var">sfResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242450"><span class="hs-identifier hs-var">resource</span></a></span><span>
</span><span id="line-402"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfVerificationRequest :: Maybe ApiRequest
</span><a href="Haskemathesis.Stateful.Checks.html#sfVerificationRequest"><span class="hs-identifier hs-var">sfVerificationRequest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiRequest -&gt; Maybe ApiRequest
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242453"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-403"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfVerificationResponse :: Maybe ApiResponse
</span><a href="Haskemathesis.Stateful.Checks.html#sfVerificationResponse"><span class="hs-identifier hs-var">sfVerificationResponse</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiResponse -&gt; Maybe ApiResponse
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242454"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-404"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfExpectedStatus :: Maybe Int
</span><a href="Haskemathesis.Stateful.Checks.html#sfExpectedStatus"><span class="hs-identifier hs-var">sfExpectedStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-405"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sfActualStatus :: Maybe Int
</span><a href="Haskemathesis.Stateful.Checks.html#sfActualStatus"><span class="hs-identifier hs-var">sfActualStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679242455"><span class="hs-identifier hs-var">status</span></a></span><span>
</span><span id="line-406"></span><span>                                            </span><span class="hs-special">}</span><span>
</span><span id="line-407"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-408"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-409"></span><span>                        </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckFailed"><span class="hs-identifier hs-type">StatefulCheckFailed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-410"></span><span>                            </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulFailure"><span class="hs-identifier hs-type">StatefulFailure</span></a></span><span>
</span><span id="line-411"></span><span>                                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfCheckName"><span class="hs-identifier hs-var">sfCheckName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;ensure-modification-persisted&quot;</span></span><span>
</span><span id="line-412"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfMessage"><span class="hs-identifier hs-var">sfMessage</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-413"></span><span>                                    </span><span class="annot"><span class="hs-string">&quot;Could not retrieve modified resource. &quot;</span></span><span>
</span><span id="line-414"></span><span>                                        </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Expected 2xx, got &quot;</span></span><span>
</span><span id="line-415"></span><span>                                        </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621679242455"><span class="hs-identifier hs-type">status</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfResource"><span class="hs-identifier hs-var">sfResource</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679242450"><span class="hs-identifier hs-type">resource</span></a></span><span>
</span><span id="line-417"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfVerificationRequest"><span class="hs-identifier hs-var">sfVerificationRequest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242453"><span class="hs-identifier hs-type">req</span></a></span><span>
</span><span id="line-418"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfVerificationResponse"><span class="hs-identifier hs-var">sfVerificationResponse</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242454"><span class="hs-identifier hs-type">response</span></a></span><span>
</span><span id="line-419"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfExpectedStatus"><span class="hs-identifier hs-var">sfExpectedStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-number">200</span></span><span>
</span><span id="line-420"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#sfActualStatus"><span class="hs-identifier hs-var">sfActualStatus</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621679242455"><span class="hs-identifier hs-type">status</span></a></span><span>
</span><span id="line-421"></span><span>                                </span><span class="hs-special">}</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="annot"><span class="hs-comment">-- | Check if actual data contains all expected top-level fields.</span></span><span>
</span><span id="line-424"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#containsExpectedFields"><span class="hs-identifier hs-type">containsExpectedFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-425"></span><span id="containsExpectedFields"><span class="annot"><span class="annottext">containsExpectedFields :: Value -&gt; Value -&gt; Bool
</span><a href="Haskemathesis.Stateful.Checks.html#containsExpectedFields"><span class="hs-identifier hs-var hs-var">containsExpectedFields</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679242461"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679242461"><span class="hs-identifier hs-var">expected</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679242462"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679242462"><span class="hs-identifier hs-var">actual</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><span class="annottext">((Key, Value) -&gt; Bool) -&gt; [(Key, Value)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">(Key, Value) -&gt; Bool
</span><a href="#local-6989586621679242464"><span class="hs-identifier hs-var">fieldMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object -&gt; [(Key, Value)]
forall v. KeyMap v -&gt; [(Key, v)]
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#toList"><span class="hs-identifier hs-var">KM.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679242461"><span class="hs-identifier hs-var">expected</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-428"></span><span>    </span><span id="local-6989586621679242464"><span class="annot"><span class="annottext">fieldMatches :: (Key, Value) -&gt; Bool
</span><a href="#local-6989586621679242464"><span class="hs-identifier hs-var hs-var">fieldMatches</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679242466"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679242466"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242467"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242467"><span class="hs-identifier hs-var">expectedVal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-429"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#lookup"><span class="hs-identifier hs-var">KM.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679242466"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679242462"><span class="hs-identifier hs-var">actual</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-430"></span><span>            </span><span class="annot"><span class="annottext">Maybe Value
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-431"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679242469"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242469"><span class="hs-identifier hs-var">actualVal</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><a href="Haskemathesis.Stateful.Checks.html#valueMatches"><span class="hs-identifier hs-var">valueMatches</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242467"><span class="hs-identifier hs-var">expectedVal</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242469"><span class="hs-identifier hs-var">actualVal</span></a></span><span>
</span><span id="line-432"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#containsExpectedFields"><span class="hs-identifier hs-var">containsExpectedFields</span></a></span><span> </span><span id="local-6989586621679242471"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242471"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span id="local-6989586621679242472"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242472"><span class="hs-identifier hs-var">actual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242471"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242472"><span class="hs-identifier hs-var">actual</span></a></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="annot"><span class="hs-comment">-- | Check if values match (for simple types, exact match; for objects, containment).</span></span><span>
</span><span id="line-435"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#valueMatches"><span class="hs-identifier hs-type">valueMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-436"></span><span id="valueMatches"><span class="annot"><span class="annottext">valueMatches :: Value -&gt; Value -&gt; Bool
</span><a href="Haskemathesis.Stateful.Checks.html#valueMatches"><span class="hs-identifier hs-var hs-var">valueMatches</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679242473"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679242473"><span class="hs-identifier hs-var">expected</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679242474"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679242474"><span class="hs-identifier hs-var">actual</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><a href="Haskemathesis.Stateful.Checks.html#containsExpectedFields"><span class="hs-identifier hs-var">containsExpectedFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-var">Object</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679242473"><span class="hs-identifier hs-var">expected</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-var">Object</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679242474"><span class="hs-identifier hs-var">actual</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#valueMatches"><span class="hs-identifier hs-var">valueMatches</span></a></span><span> </span><span id="local-6989586621679242475"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242475"><span class="hs-identifier hs-var">expected</span></a></span></span><span> </span><span id="local-6989586621679242476"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242476"><span class="hs-identifier hs-var">actual</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242475"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242476"><span class="hs-identifier hs-var">actual</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="annot"><span class="hs-comment">{- | Run all stateful checks against the test state.

Executes each check in sequence and collects all results.
Failed checks do not prevent subsequent checks from running.

=== Example

@
let checks = [useAfterFree, ensureResourceAvailability]
results &lt;- runStatefulChecks executor ops state checks
let failures = [f | StatefulCheckFailed f &lt;- results]
when (not $ null failures) $
    fail $ &quot;Stateful checks failed: &quot; ++ show (length failures)
@
-}</span></span><span>
</span><span id="line-455"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#runStatefulChecks"><span class="hs-identifier hs-type">runStatefulChecks</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-456"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ExecutorWithTimeout"><span class="hs-identifier hs-type">ExecutorWithTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-458"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#TestState"><span class="hs-identifier hs-type">TestState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier hs-type">StatefulCheck</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-460"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier hs-type">StatefulCheckResult</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-461"></span><span id="runStatefulChecks"><span class="annot"><span class="annottext">runStatefulChecks :: ExecutorWithTimeout
-&gt; [ResolvedOperation]
-&gt; TestState
-&gt; [StatefulCheck]
-&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#runStatefulChecks"><span class="hs-identifier hs-var hs-var">runStatefulChecks</span></a></span></span><span> </span><span id="local-6989586621679242477"><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242477"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span id="local-6989586621679242478"><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242478"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621679242479"><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242479"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621679242480"><span class="annot"><span class="annottext">[StatefulCheck]
</span><a href="#local-6989586621679242480"><span class="hs-identifier hs-var">checks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-462"></span><span>    </span><span id="local-6989586621679242481"><span class="annot"><a href="#local-6989586621679242481"><span class="hs-identifier hs-var">resultLists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(StatefulCheck -&gt; IO [StatefulCheckResult])
-&gt; [StatefulCheck] -&gt; IO [[StatefulCheckResult]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679242482"><span class="annot"><span class="annottext">StatefulCheck
</span><a href="#local-6989586621679242482"><span class="hs-identifier hs-var">check</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StatefulCheck
-&gt; ExecutorWithTimeout
-&gt; [ResolvedOperation]
-&gt; TestState
-&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#scRun"><span class="hs-identifier hs-var">scRun</span></a></span><span> </span><span class="annot"><span class="annottext">StatefulCheck
</span><a href="#local-6989586621679242482"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242477"><span class="hs-identifier hs-var">executor</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242478"><span class="hs-identifier hs-var">ops</span></a></span><span> </span><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242479"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StatefulCheck]
</span><a href="#local-6989586621679242480"><span class="hs-identifier hs-var">checks</span></a></span><span>
</span><span id="line-463"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><a href="#local-6989586621679242481"><span class="hs-identifier hs-type">resultLists</span></a></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span class="annot"><span class="hs-comment">{- | Run a single stateful check.

Convenience function for running a single check.
-}</span></span><span>
</span><span id="line-469"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#runStatefulCheck"><span class="hs-identifier hs-type">runStatefulCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-470"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ExecutorWithTimeout"><span class="hs-identifier hs-type">ExecutorWithTimeout</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#TestState"><span class="hs-identifier hs-type">TestState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheck"><span class="hs-identifier hs-type">StatefulCheck</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-474"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#StatefulCheckResult"><span class="hs-identifier hs-type">StatefulCheckResult</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-475"></span><span id="runStatefulCheck"><span class="annot"><span class="annottext">runStatefulCheck :: ExecutorWithTimeout
-&gt; [ResolvedOperation]
-&gt; TestState
-&gt; StatefulCheck
-&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#runStatefulCheck"><span class="hs-identifier hs-var hs-var">runStatefulCheck</span></a></span></span><span> </span><span id="local-6989586621679242484"><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242484"><span class="hs-identifier hs-var">executor</span></a></span></span><span> </span><span id="local-6989586621679242485"><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242485"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621679242486"><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242486"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span id="local-6989586621679242487"><span class="annot"><span class="annottext">StatefulCheck
</span><a href="#local-6989586621679242487"><span class="hs-identifier hs-var">check</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><span class="annottext">StatefulCheck
-&gt; ExecutorWithTimeout
-&gt; [ResolvedOperation]
-&gt; TestState
-&gt; IO [StatefulCheckResult]
</span><a href="Haskemathesis.Stateful.Checks.html#scRun"><span class="hs-identifier hs-var">scRun</span></a></span><span> </span><span class="annot"><span class="annottext">StatefulCheck
</span><a href="#local-6989586621679242487"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">ExecutorWithTimeout
</span><a href="#local-6989586621679242484"><span class="hs-identifier hs-var">executor</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242485"><span class="hs-identifier hs-var">ops</span></a></span><span> </span><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242486"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="annot"><span class="hs-comment">{- | Build a GET request for a resource.

Constructs an ApiRequest to retrieve the specified resource
by interpolating path parameters from the resource identifiers.

=== Example

@
let resource = ResourceRef &quot;createUser&quot; &quot;/users/{id}&quot; (Map.singleton &quot;id&quot; (Number 42))
    getOp = ... -- ResolvedOperation for GET /users/{id}
    req = buildResourceRequest getOp resource
-- req.reqPath = &quot;/users/42&quot;
@
-}</span></span><span>
</span><span id="line-492"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#buildResourceRequest"><span class="hs-identifier hs-type">buildResourceRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiRequest"><span class="hs-identifier hs-type">ApiRequest</span></a></span><span>
</span><span id="line-493"></span><span id="buildResourceRequest"><span class="annot"><span class="annottext">buildResourceRequest :: ResolvedOperation -&gt; ResourceRef -&gt; ApiRequest
</span><a href="Haskemathesis.Stateful.Checks.html#buildResourceRequest"><span class="hs-identifier hs-var hs-var">buildResourceRequest</span></a></span></span><span> </span><span id="local-6989586621679242488"><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242488"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679242489"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242489"><span class="hs-identifier hs-var">resource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiRequest"><span class="hs-identifier hs-type">ApiRequest</span></a></span><span>
</span><span id="line-495"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">reqMethod :: ByteString
</span><a href="Haskemathesis.Execute.Types.html#reqMethod"><span class="hs-identifier hs-var">reqMethod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.Method.html#methodGet"><span class="hs-identifier hs-var">methodGet</span></a></span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">reqPath :: Text
</span><a href="Haskemathesis.Execute.Types.html#reqPath"><span class="hs-identifier hs-var">reqPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Value -&gt; Text
</span><a href="Haskemathesis.Stateful.Checks.html#interpolatePath"><span class="hs-identifier hs-var">interpolatePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResolvedOperation -&gt; Text
</span><a href="Haskemathesis.OpenApi.Types.html#roPath"><span class="hs-identifier hs-var">roPath</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242488"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResourceRef -&gt; Map Text Value
</span><a href="Haskemathesis.Stateful.Types.html#rrIdentifiers"><span class="hs-identifier hs-var">rrIdentifiers</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242489"><span class="hs-identifier hs-var">resource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">reqQueryParams :: [(Text, Text)]
</span><a href="Haskemathesis.Execute.Types.html#reqQueryParams"><span class="hs-identifier hs-var">reqQueryParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">reqHeaders :: [(HeaderName, ByteString)]
</span><a href="Haskemathesis.Execute.Types.html#reqHeaders"><span class="hs-identifier hs-var">reqHeaders</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">reqBody :: Maybe (Text, ByteString)
</span><a href="Haskemathesis.Execute.Types.html#reqBody"><span class="hs-identifier hs-var">reqBody</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Text, ByteString)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="annot"><span class="hs-comment">-- | Interpolate path parameters into a path template.</span></span><span>
</span><span id="line-503"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#interpolatePath"><span class="hs-identifier hs-type">interpolatePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-504"></span><span id="interpolatePath"><span class="annot"><span class="annottext">interpolatePath :: Text -&gt; Map Text Value -&gt; Text
</span><a href="Haskemathesis.Stateful.Checks.html#interpolatePath"><span class="hs-identifier hs-var hs-var">interpolatePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value -&gt; Text -&gt; Text) -&gt; Text -&gt; Map Text Value -&gt; Text
forall k a b. (k -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Map k a -&gt; b
</span><span class="hs-identifier hs-var">Map.foldrWithKey</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value -&gt; Text -&gt; Text
</span><a href="#local-6989586621679242499"><span class="hs-identifier hs-var">replaceParam</span></a></span><span>
</span><span id="line-505"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-506"></span><span>    </span><span class="annot"><a href="#local-6989586621679242499"><span class="hs-identifier hs-type">replaceParam</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-507"></span><span>    </span><span id="local-6989586621679242499"><span class="annot"><span class="annottext">replaceParam :: Text -&gt; Value -&gt; Text -&gt; Text
</span><a href="#local-6989586621679242499"><span class="hs-identifier hs-var hs-var">replaceParam</span></a></span></span><span> </span><span id="local-6989586621679242500"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242500"><span class="hs-identifier hs-var">paramName</span></a></span></span><span> </span><span id="local-6989586621679242501"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242501"><span class="hs-identifier hs-var">paramValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-508"></span><span>        </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; Text -&gt; Text
Text -&gt; Text -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.replace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;{&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242500"><span class="hs-identifier hs-var">paramName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;}&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Text
</span><a href="Haskemathesis.Stateful.Checks.html#renderValue"><span class="hs-identifier hs-var">renderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242501"><span class="hs-identifier hs-var">paramValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="annot"><span class="hs-comment">-- | Render a JSON value as text for path interpolation.</span></span><span>
</span><span id="line-511"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#renderValue"><span class="hs-identifier hs-type">renderValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-512"></span><span id="renderValue"><span class="annot"><span class="annottext">renderValue :: Value -&gt; Text
</span><a href="Haskemathesis.Stateful.Checks.html#renderValue"><span class="hs-identifier hs-var hs-var">renderValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621679242505"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242505"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242505"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-513"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#renderValue"><span class="hs-identifier hs-var">renderValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Number"><span class="hs-identifier hs-type">Number</span></a></span><span> </span><span id="local-6989586621679242507"><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679242507"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-comment">-- Render integers without decimal point</span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Either Double Integer
forall r i. (RealFloat r, Integral i) =&gt; Scientific -&gt; Either r i
</span><a href="file:///nix/store/hwr0895a4mk8gp1c52mqxqwygppa2imi-scientific-0.3.8.0-doc/share/doc/scientific-0.3.8.0/html/src/Data.Scientific.html#floatingOrInteger"><span class="hs-identifier hs-var">Scientific.floatingOrInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679242507"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-516"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679242507"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-517"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679242509"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679242509"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679242509"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#renderValue"><span class="hs-identifier hs-var">renderValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;true&quot;</span></span><span>
</span><span id="line-519"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#renderValue"><span class="hs-identifier hs-var">renderValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;false&quot;</span></span><span>
</span><span id="line-520"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#renderValue"><span class="hs-identifier hs-var">renderValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">Null</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;null&quot;</span></span><span>
</span><span id="line-521"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#renderValue"><span class="hs-identifier hs-var">renderValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-522"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#renderValue"><span class="hs-identifier hs-var">renderValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="annot"><span class="hs-comment">{- | Find all resources that were deleted during the test.

Scans the test history for DELETE operations and extracts
resource references from them.
-}</span></span><span>
</span><span id="line-529"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#findDeletedResources"><span class="hs-identifier hs-type">findDeletedResources</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#TestState"><span class="hs-identifier hs-type">TestState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-530"></span><span id="findDeletedResources"><span class="annot"><span class="annottext">findDeletedResources :: TestState -&gt; [ResourceRef]
</span><a href="Haskemathesis.Stateful.Checks.html#findDeletedResources"><span class="hs-identifier hs-var hs-var">findDeletedResources</span></a></span></span><span> </span><span id="local-6989586621679242513"><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242513"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-531"></span><span>    </span><span class="annot"><span class="annottext">((Text, ApiRequest, ApiResponse) -&gt; Maybe ResourceRef)
-&gt; [(Text, ApiRequest, ApiResponse)] -&gt; [ResourceRef]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(Text, ApiRequest, ApiResponse) -&gt; Maybe ResourceRef
</span><a href="#local-6989586621679242514"><span class="hs-identifier hs-var">extractDeletedResource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestState -&gt; [(Text, ApiRequest, ApiResponse)]
</span><a href="Haskemathesis.Stateful.Types.html#tsHistory"><span class="hs-identifier hs-var">tsHistory</span></a></span><span> </span><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242513"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-533"></span><span>    </span><span id="local-6989586621679242514"><span class="annot"><span class="annottext">extractDeletedResource :: (Text, ApiRequest, ApiResponse) -&gt; Maybe ResourceRef
</span><a href="#local-6989586621679242514"><span class="hs-identifier hs-var hs-var">extractDeletedResource</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679242521"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242521"><span class="hs-identifier hs-var">opLabel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242522"><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242522"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242523"><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242523"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DELETE&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242521"><span class="hs-identifier hs-var">opLabel</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679242526"><span class="hs-identifier hs-var">isDeletePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiRequest -&gt; Text
</span><a href="Haskemathesis.Execute.Types.html#reqPath"><span class="hs-identifier hs-var">reqPath</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242522"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-535"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ApiResponse -&gt; Int
</span><a href="Haskemathesis.Execute.Types.html#resStatusCode"><span class="hs-identifier hs-var">resStatusCode</span></a></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242523"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ApiResponse -&gt; Int
</span><a href="Haskemathesis.Execute.Types.html#resStatusCode"><span class="hs-identifier hs-var">resStatusCode</span></a></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242523"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">300</span></span><span>
</span><span id="line-536"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-537"></span><span>                    </span><span class="annot"><span class="annottext">ResourceRef -&gt; Maybe ResourceRef
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(ResourceRef -&gt; Maybe ResourceRef)
-&gt; ResourceRef -&gt; Maybe ResourceRef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-538"></span><span>                        </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span>
</span><span id="line-539"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rrOperationId :: Text
</span><a href="Haskemathesis.Stateful.Types.html#rrOperationId"><span class="hs-identifier hs-var">rrOperationId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242521"><span class="hs-identifier hs-var">opLabel</span></a></span><span>
</span><span id="line-540"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rrResourcePath :: Text
</span><a href="Haskemathesis.Stateful.Types.html#rrResourcePath"><span class="hs-identifier hs-var">rrResourcePath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiRequest -&gt; Text
</span><a href="Haskemathesis.Execute.Types.html#reqPath"><span class="hs-identifier hs-var">reqPath</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242522"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-541"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rrIdentifiers :: Map Text Value
</span><a href="Haskemathesis.Stateful.Types.html#rrIdentifiers"><span class="hs-identifier hs-var">rrIdentifiers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Value
</span><a href="Haskemathesis.Stateful.Checks.html#extractPathIds"><span class="hs-identifier hs-var">extractPathIds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiRequest -&gt; Text
</span><a href="Haskemathesis.Execute.Types.html#reqPath"><span class="hs-identifier hs-var">reqPath</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242522"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-543"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe ResourceRef
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-544"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ResourceRef
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span>    </span><span id="local-6989586621679242526"><span class="annot"><span class="annottext">isDeletePath :: Text -&gt; Bool
</span><a href="#local-6989586621679242526"><span class="hs-identifier hs-var hs-var">isDeletePath</span></a></span></span><span> </span><span id="local-6989586621679242531"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242531"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-547"></span><span>        </span><span class="hs-comment">-- Heuristic: DELETE operations typically have an ID in the path</span><span>
</span><span id="line-548"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;{&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.isInfixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242531"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679242533"><span class="hs-identifier hs-var">hasIdSegment</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242531"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>    </span><span id="local-6989586621679242533"><span class="annot"><span class="annottext">hasIdSegment :: Text -&gt; Bool
</span><a href="#local-6989586621679242533"><span class="hs-identifier hs-var hs-var">hasIdSegment</span></a></span></span><span> </span><span id="local-6989586621679242538"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242538"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-551"></span><span>        </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; [Text] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679242539"><span class="hs-identifier hs-var">isIdSegment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; [Text]
Text -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.splitOn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242538"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span>    </span><span id="local-6989586621679242539"><span class="annot"><span class="annottext">isIdSegment :: Text -&gt; Bool
</span><a href="#local-6989586621679242539"><span class="hs-identifier hs-var hs-var">isIdSegment</span></a></span></span><span> </span><span id="local-6989586621679242541"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242541"><span class="hs-identifier hs-var">segment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-554"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242541"><span class="hs-identifier hs-var">segment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.all</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isDigit</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242541"><span class="hs-identifier hs-var">segment</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679242544"><span class="hs-identifier hs-var">isUuidLike</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242541"><span class="hs-identifier hs-var">segment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span>    </span><span id="local-6989586621679242544"><span class="annot"><span class="annottext">isUuidLike :: Text -&gt; Bool
</span><a href="#local-6989586621679242544"><span class="hs-identifier hs-var hs-var">isUuidLike</span></a></span></span><span> </span><span id="local-6989586621679242552"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242552"><span class="hs-identifier hs-var">segment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-558"></span><span>        </span><span class="hs-comment">-- Use compareLength for efficient short-circuiting before counting dashes</span><span>
</span><span id="line-559"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Int -&gt; Ordering
</span><span class="hs-identifier hs-var">T.compareLength</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242552"><span class="hs-identifier hs-var">segment</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">36</span></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; Int
Text -&gt; Text -&gt; Int
</span><span class="hs-identifier hs-var">T.count</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242552"><span class="hs-identifier hs-var">segment</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="annot"><span class="hs-comment">{- | Find all resources that were created during the test.

Returns resources from tsCreatedResources that have not been deleted.
-}</span></span><span>
</span><span id="line-565"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#findCreatedResources"><span class="hs-identifier hs-type">findCreatedResources</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#TestState"><span class="hs-identifier hs-type">TestState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-566"></span><span id="findCreatedResources"><span class="annot"><span class="annottext">findCreatedResources :: TestState -&gt; [ResourceRef]
</span><a href="Haskemathesis.Stateful.Checks.html#findCreatedResources"><span class="hs-identifier hs-var hs-var">findCreatedResources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TestState -&gt; [ResourceRef]
</span><a href="Haskemathesis.Stateful.Types.html#tsCreatedResources"><span class="hs-identifier hs-var">tsCreatedResources</span></a></span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="annot"><span class="hs-comment">{- | Find all resources that were modified (PUT/PATCH) during the test.

Returns pairs of (ResourceRef, ModificationData) for each modification.
-}</span></span><span>
</span><span id="line-572"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#findModifiedResources"><span class="hs-identifier hs-type">findModifiedResources</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#TestState"><span class="hs-identifier hs-type">TestState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-573"></span><span id="findModifiedResources"><span class="annot"><span class="annottext">findModifiedResources :: TestState -&gt; [(ResourceRef, Value)]
</span><a href="Haskemathesis.Stateful.Checks.html#findModifiedResources"><span class="hs-identifier hs-var hs-var">findModifiedResources</span></a></span></span><span> </span><span id="local-6989586621679242556"><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242556"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-574"></span><span>    </span><span class="annot"><span class="annottext">((Text, ApiRequest, ApiResponse) -&gt; Maybe (ResourceRef, Value))
-&gt; [(Text, ApiRequest, ApiResponse)] -&gt; [(ResourceRef, Value)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(Text, ApiRequest, ApiResponse) -&gt; Maybe (ResourceRef, Value)
forall {b}.
FromJSON b =&gt;
(Text, ApiRequest, ApiResponse) -&gt; Maybe (ResourceRef, b)
</span><a href="#local-6989586621679242557"><span class="hs-identifier hs-var">extractModification</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestState -&gt; [(Text, ApiRequest, ApiResponse)]
</span><a href="Haskemathesis.Stateful.Types.html#tsHistory"><span class="hs-identifier hs-var">tsHistory</span></a></span><span> </span><span class="annot"><span class="annottext">TestState
</span><a href="#local-6989586621679242556"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-576"></span><span>    </span><span id="local-6989586621679242557"><span class="annot"><span class="annottext">extractModification :: (Text, ApiRequest, ApiResponse) -&gt; Maybe (ResourceRef, b)
</span><a href="#local-6989586621679242557"><span class="hs-identifier hs-var hs-var">extractModification</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679242564"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242564"><span class="hs-identifier hs-var">opLabel</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242565"><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242565"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242566"><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242566"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679242567"><span class="hs-identifier hs-var">isPutOrPatch</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242564"><span class="hs-identifier hs-var">opLabel</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-578"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ApiResponse -&gt; Int
</span><a href="Haskemathesis.Execute.Types.html#resStatusCode"><span class="hs-identifier hs-var">resStatusCode</span></a></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242566"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ApiResponse -&gt; Int
</span><a href="Haskemathesis.Execute.Types.html#resStatusCode"><span class="hs-identifier hs-var">resStatusCode</span></a></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242566"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">300</span></span><span>
</span><span id="line-579"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ApiRequest -&gt; Maybe (Text, ByteString)
</span><a href="Haskemathesis.Execute.Types.html#reqBody"><span class="hs-identifier hs-var">reqBody</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242565"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-580"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242568"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679242568"><span class="hs-identifier hs-var">bodyBytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-581"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe b
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Decoding.html#decodeStrict"><span class="hs-identifier hs-var">Aeson.decodeStrict</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679242568"><span class="hs-identifier hs-var">bodyBytes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-582"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679242569"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679242569"><span class="hs-identifier hs-var">bodyValue</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-583"></span><span>                                </span><span class="annot"><span class="annottext">(ResourceRef, b) -&gt; Maybe (ResourceRef, b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-584"></span><span>                                    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span>
</span><span id="line-585"></span><span>                                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rrOperationId :: Text
</span><a href="Haskemathesis.Stateful.Types.html#rrOperationId"><span class="hs-identifier hs-var">rrOperationId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242564"><span class="hs-identifier hs-var">opLabel</span></a></span><span>
</span><span id="line-586"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rrResourcePath :: Text
</span><a href="Haskemathesis.Stateful.Types.html#rrResourcePath"><span class="hs-identifier hs-var">rrResourcePath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiRequest -&gt; Text
</span><a href="Haskemathesis.Execute.Types.html#reqPath"><span class="hs-identifier hs-var">reqPath</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242565"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-587"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rrIdentifiers :: Map Text Value
</span><a href="Haskemathesis.Stateful.Types.html#rrIdentifiers"><span class="hs-identifier hs-var">rrIdentifiers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Map Text Value
</span><a href="Haskemathesis.Stateful.Checks.html#extractPathIds"><span class="hs-identifier hs-var">extractPathIds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiRequest -&gt; Text
</span><a href="Haskemathesis.Execute.Types.html#reqPath"><span class="hs-identifier hs-var">reqPath</span></a></span><span> </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242565"><span class="hs-identifier hs-var">req</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>                                        </span><span class="hs-special">}</span><span>
</span><span id="line-589"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679242569"><span class="hs-identifier hs-var">bodyValue</span></a></span><span>
</span><span id="line-590"></span><span>                                    </span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>                            </span><span class="annot"><span class="annottext">Maybe b
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ResourceRef, b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-592"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (Text, ByteString)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ResourceRef, b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-593"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (ResourceRef, b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (ResourceRef, b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span>    </span><span id="local-6989586621679242567"><span class="annot"><span class="annottext">isPutOrPatch :: Text -&gt; Bool
</span><a href="#local-6989586621679242567"><span class="hs-identifier hs-var hs-var">isPutOrPatch</span></a></span></span><span> </span><span id="local-6989586621679242574"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242574"><span class="hs-keyword hs-var">label</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-597"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;PUT&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242574"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-598"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;PATCH&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242574"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-599"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;update&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.isInfixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toLower</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242574"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-600"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;modify&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.isInfixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toLower</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242574"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span class="annot"><span class="hs-comment">-- | Extract path segment IDs from a concrete path.</span></span><span>
</span><span id="line-603"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#extractPathIds"><span class="hs-identifier hs-type">extractPathIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-604"></span><span id="extractPathIds"><span class="annot"><span class="annottext">extractPathIds :: Text -&gt; Map Text Value
</span><a href="Haskemathesis.Stateful.Checks.html#extractPathIds"><span class="hs-identifier hs-var hs-var">extractPathIds</span></a></span></span><span> </span><span id="local-6989586621679242576"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242576"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-605"></span><span>    </span><span class="annot"><span class="annottext">[(Text, Value)] -&gt; Map Text Value
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Text, Value)] -&gt; Map Text Value)
-&gt; [(Text, Value)] -&gt; Map Text Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Int, Text) -&gt; Maybe (Text, Value))
-&gt; [(Int, Text)] -&gt; [(Text, Value)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(Int, Text) -&gt; Maybe (Text, Value)
</span><a href="#local-6989586621679242578"><span class="hs-identifier hs-var">extractId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; [Text] -&gt; [(Int, Text)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242579"><span class="hs-identifier hs-var">segments</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-607"></span><span>    </span><span id="local-6989586621679242579"><span class="annot"><span class="annottext">segments :: [Text]
</span><a href="#local-6989586621679242579"><span class="hs-identifier hs-var hs-var">segments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; [Text] -&gt; [Text]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Text -&gt; Bool) -&gt; Text -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.null</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; [Text]) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; [Text]
Text -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.splitOn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242576"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><a href="#local-6989586621679242578"><span class="hs-identifier hs-type">extractId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>    </span><span id="local-6989586621679242578"><span class="annot"><span class="annottext">extractId :: (Int, Text) -&gt; Maybe (Text, Value)
</span><a href="#local-6989586621679242578"><span class="hs-identifier hs-var hs-var">extractId</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679242583"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679242583"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242584"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242584"><span class="hs-identifier hs-var">segment</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679242585"><span class="hs-identifier hs-var">isNumeric</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242584"><span class="hs-identifier hs-var">segment</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-611"></span><span>            </span><span class="hs-comment">-- Use readMaybe to safely parse the number, avoiding partial 'read'</span><span>
</span><span id="line-612"></span><span>            </span><span id="local-6989586621679242586"><span class="annot"><a href="#local-6989586621679242586"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe Integer
forall a. Read a =&gt; String -&gt; Maybe a
</span><span class="hs-identifier hs-var">readMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242584"><span class="hs-identifier hs-var">segment</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-613"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679242594"><span class="annot"><a href="#local-6989586621679242594"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;id&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679242583"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679242583"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679242594"><span class="hs-identifier hs-type">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Number"><span class="hs-identifier hs-type">Number</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromInteger</span></span><span> </span><span class="annot"><a href="#local-6989586621679242586"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><a href="#local-6989586621679242595"><span class="hs-identifier hs-var">isUuidLike</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242584"><span class="hs-identifier hs-var">segment</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-616"></span><span>            </span><span class="annot"><span class="annottext">(Text, Value) -&gt; Maybe (Text, Value)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;id&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679242583"><span class="hs-identifier hs-var">idx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679242583"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242584"><span class="hs-identifier hs-var">segment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Text, Value)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span>    </span><span id="local-6989586621679242585"><span class="annot"><span class="annottext">isNumeric :: Text -&gt; Bool
</span><a href="#local-6989586621679242585"><span class="hs-identifier hs-var hs-var">isNumeric</span></a></span></span><span> </span><span id="local-6989586621679242596"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242596"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242596"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.all</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isDigit</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242596"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-620"></span><span>    </span><span class="hs-comment">-- Use compareLength for efficient short-circuiting before counting dashes</span><span>
</span><span id="line-621"></span><span>    </span><span id="local-6989586621679242595"><span class="annot"><span class="annottext">isUuidLike :: Text -&gt; Bool
</span><a href="#local-6989586621679242595"><span class="hs-identifier hs-var hs-var">isUuidLike</span></a></span></span><span> </span><span id="local-6989586621679242603"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242603"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Int -&gt; Ordering
</span><span class="hs-identifier hs-var">T.compareLength</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242603"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">36</span></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; Int
Text -&gt; Text -&gt; Int
</span><span class="hs-identifier hs-var">T.count</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242603"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="annot"><span class="hs-comment">-- | Find a GET operation that can retrieve the given resource.</span></span><span>
</span><span id="line-624"></span><span class="annot"><a href="Haskemathesis.Stateful.Checks.html#findGetOperation"><span class="hs-identifier hs-type">findGetOperation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Haskemathesis.Stateful.Types.html#ResourceRef"><span class="hs-identifier hs-type">ResourceRef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResolvedOperation"><span class="hs-identifier hs-type">ResolvedOperation</span></a></span><span>
</span><span id="line-625"></span><span id="findGetOperation"><span class="annot"><span class="annottext">findGetOperation :: [ResolvedOperation] -&gt; ResourceRef -&gt; Maybe ResolvedOperation
</span><a href="Haskemathesis.Stateful.Checks.html#findGetOperation"><span class="hs-identifier hs-var hs-var">findGetOperation</span></a></span></span><span> </span><span id="local-6989586621679242604"><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242604"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span id="local-6989586621679242605"><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242605"><span class="hs-identifier hs-var">resource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-626"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(ResolvedOperation -&gt; Bool)
-&gt; [ResolvedOperation] -&gt; [ResolvedOperation]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">ResolvedOperation -&gt; Bool
</span><a href="#local-6989586621679242606"><span class="hs-identifier hs-var">isMatchingGet</span></a></span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation]
</span><a href="#local-6989586621679242604"><span class="hs-identifier hs-var">ops</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-627"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679242607"><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242607"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[ResolvedOperation]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ResolvedOperation -&gt; Maybe ResolvedOperation
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242607"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-628"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ResolvedOperation
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-630"></span><span>    </span><span id="local-6989586621679242606"><span class="annot"><span class="annottext">isMatchingGet :: ResolvedOperation -&gt; Bool
</span><a href="#local-6989586621679242606"><span class="hs-identifier hs-var hs-var">isMatchingGet</span></a></span></span><span> </span><span id="local-6989586621679242610"><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242610"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-631"></span><span>        </span><span class="annot"><span class="annottext">ResolvedOperation -&gt; Text
</span><a href="Haskemathesis.OpenApi.Types.html#roMethod"><span class="hs-identifier hs-var">roMethod</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242610"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;GET&quot;</span></span><span>
</span><span id="line-632"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><a href="#local-6989586621679242612"><span class="hs-identifier hs-var">pathMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResolvedOperation -&gt; Text
</span><a href="Haskemathesis.OpenApi.Types.html#roPath"><span class="hs-identifier hs-var">roPath</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242610"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResourceRef -&gt; Text
</span><a href="Haskemathesis.Stateful.Types.html#rrResourcePath"><span class="hs-identifier hs-var">rrResourcePath</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceRef
</span><a href="#local-6989586621679242605"><span class="hs-identifier hs-var">resource</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span>    </span><span id="local-6989586621679242612"><span class="annot"><span class="annottext">pathMatches :: Text -&gt; Text -&gt; Bool
</span><a href="#local-6989586621679242612"><span class="hs-identifier hs-var hs-var">pathMatches</span></a></span></span><span> </span><span id="local-6989586621679242614"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242614"><span class="hs-identifier hs-var">template</span></a></span></span><span> </span><span id="local-6989586621679242615"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242615"><span class="hs-identifier hs-var">concrete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-635"></span><span>        </span><span class="hs-comment">-- Check if template matches concrete path structure</span><span>
</span><span id="line-636"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679242619"><span class="annot"><span class="annottext">templateSegments :: [Text]
</span><a href="#local-6989586621679242619"><span class="hs-identifier hs-var hs-var">templateSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; [Text]
Text -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.splitOn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242614"><span class="hs-identifier hs-var">template</span></a></span><span>
</span><span id="line-637"></span><span>            </span><span id="local-6989586621679242623"><span class="annot"><span class="annottext">concreteSegments :: [Text]
</span><a href="#local-6989586621679242623"><span class="hs-identifier hs-var hs-var">concreteSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; [Text]
Text -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.splitOn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;/&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242615"><span class="hs-identifier hs-var">concrete</span></a></span><span>
</span><span id="line-638"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- Use lazy length comparison to avoid traversing lists twice</span><span>
</span><span id="line-639"></span><span>            </span><span class="hs-comment">-- and to work safely with any list size</span><span>
</span><span id="line-640"></span><span>            </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="#local-6989586621679242624"><span class="hs-identifier hs-var">sameLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242619"><span class="hs-identifier hs-var">templateSegments</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242623"><span class="hs-identifier hs-var">concreteSegments</span></a></span><span>
</span><span id="line-641"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">((Text, Text) -&gt; Bool) -&gt; [(Text, Text)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">(Text, Text) -&gt; Bool
</span><a href="#local-6989586621679242625"><span class="hs-identifier hs-var">segmentMatches</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [(Text, Text)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242619"><span class="hs-identifier hs-var">templateSegments</span></a></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242623"><span class="hs-identifier hs-var">concreteSegments</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>    </span><span class="hs-comment">-- Safe length comparison that short-circuits and works with any list</span><span>
</span><span id="line-644"></span><span>    </span><span id="local-6989586621679242147"><span id="local-6989586621679242148"><span class="annot"><a href="#local-6989586621679242624"><span class="hs-identifier hs-type">sameLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679242147"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679242148"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-645"></span><span>    </span><span id="local-6989586621679242624"><span class="annot"><span class="annottext">sameLength :: forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="#local-6989586621679242624"><span class="hs-identifier hs-var hs-var">sameLength</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-646"></span><span>    </span><span class="annot"><a href="#local-6989586621679242624"><span class="hs-identifier hs-var">sameLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679242626"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679242626"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679242627"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679242627"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [b] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="#local-6989586621679242624"><span class="hs-identifier hs-var">sameLength</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679242626"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679242627"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-647"></span><span>    </span><span class="annot"><a href="#local-6989586621679242624"><span class="hs-identifier hs-var">sameLength</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span>    </span><span id="local-6989586621679242625"><span class="annot"><span class="annottext">segmentMatches :: (Text, Text) -&gt; Bool
</span><a href="#local-6989586621679242625"><span class="hs-identifier hs-var hs-var">segmentMatches</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679242631"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242631"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242632"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242632"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;{&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242631"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;}&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-operator hs-var">`T.isSuffixOf`</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242631"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-651"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242631"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242632"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-652"></span></pre></body></html>