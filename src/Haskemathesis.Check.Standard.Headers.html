<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">{- |
Module      : Haskemathesis.Check.Standard.Headers
Description : Response header conformance validation
Stability   : experimental

This module provides checks for validating API response headers against
the OpenAPI specification. It verifies that required headers are present
and that header values conform to their documented schemas.
-}</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html"><span class="hs-identifier">Haskemathesis.Check.Standard.Headers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#responseHeadersConformance"><span class="hs-identifier">responseHeadersConformance</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/j3bcnc7r5q4sz7xij5naq8pf2zh1xr44-case-insensitive-1.2.1.0-doc/share/doc/case-insensitive-1.2.1.0/html/src/Data.CaseInsensitive.html"><span class="hs-identifier">Data.CaseInsensitive</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CI</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/hwr0895a4mk8gp1c52mqxqwygppa2imi-scientific-0.3.8.0-doc/share/doc/scientific-0.3.8.0/html/src/Data.Scientific.html"><span class="hs-identifier">Data.Scientific</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/hwr0895a4mk8gp1c52mqxqwygppa2imi-scientific-0.3.8.0-doc/share/doc/scientific-0.3.8.0/html/src/Data.Scientific.html#fromFloatDigits"><span class="hs-identifier">fromFloatDigits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeUtf8</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">encodeUtf8</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Vector</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Haskemathesis.Check.Standard.Helpers.html"><span class="hs-identifier">Haskemathesis.Check.Standard.Helpers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Haskemathesis.Check.Standard.Helpers.html#failureDetail"><span class="hs-identifier">failureDetail</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Check.Standard.Helpers.html#normalizeMapKeys"><span class="hs-identifier">normalizeMapKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Check.Standard.Helpers.html#responseSchemasForStatus"><span class="hs-identifier">responseSchemasForStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Haskemathesis.Check.Types.html"><span class="hs-identifier">Haskemathesis.Check.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Haskemathesis.Check.Types.html#Check"><span class="hs-identifier">Check</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Check.Types.html#CheckResult"><span class="hs-identifier">CheckResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Haskemathesis.Execute.Types.html"><span class="hs-identifier">Haskemathesis.Execute.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Haskemathesis.Execute.Types.html#ApiResponse"><span class="hs-identifier">ApiResponse</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html"><span class="hs-identifier">Haskemathesis.OpenApi.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResponseSpec"><span class="hs-identifier">ResponseSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Haskemathesis.Schema.html"><span class="hs-identifier">Haskemathesis.Schema</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Haskemathesis.Schema.html#Schema"><span class="hs-identifier">Schema</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Schema.html#SchemaType"><span class="hs-identifier">SchemaType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Schema.html#emptySchema"><span class="hs-identifier">emptySchema</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Haskemathesis.Validate.html"><span class="hs-identifier">Haskemathesis.Validate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Haskemathesis.Validate.html#validateErrors"><span class="hs-identifier">validateErrors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.html"><span class="hs-identifier">Network.HTTP.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.Header.html#HeaderName"><span class="hs-identifier">HeaderName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Read</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="annot"><span class="hs-comment">{- | Check that response headers conform to the OpenAPI specification.

This check validates response headers in two ways:

1. __Required headers__: Verifies that all headers marked as required
  in the spec are present in the response
2. __Schema validation__: Validates header values against their
  documented JSON schemas

==== Behavior

* __Passes__ when no response schema is defined for the status code
* __Passes__ when all required headers are present and valid
* __Fails__ when a required header is missing
* __Fails__ when a header value violates its schema

==== Header value parsing

Header values are parsed according to their schema type:

* @string@ - Used as-is (with quotes stripped if present)
* @integer@ / @number@ - Parsed as numeric values
* @boolean@ - Parsed from &quot;true&quot; or &quot;false&quot; (case-insensitive)
* @array@ - Parsed from comma-separated values or multiple headers

==== Example

@
-- Include header validation in your checks
checks = ['responseHeadersConformance', 'contentTypeConformance']
@
-}</span></span><span>
</span><span id="line-68"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#responseHeadersConformance"><span class="hs-identifier hs-type">responseHeadersConformance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Check.Types.html#Check"><span class="hs-identifier hs-type">Check</span></a></span><span>
</span><span id="line-69"></span><span id="responseHeadersConformance"><span class="annot"><span class="annottext">responseHeadersConformance :: Check
</span><a href="Haskemathesis.Check.Standard.Headers.html#responseHeadersConformance"><span class="hs-identifier hs-var hs-var">responseHeadersConformance</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">Text
-&gt; (ApiRequest -&gt; ApiResponse -&gt; ResolvedOperation -&gt; CheckResult)
-&gt; Check
</span><a href="Haskemathesis.Check.Types.html#Check"><span class="hs-identifier hs-var">Check</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;response_headers_conformance&quot;</span></span><span> </span><span class="annot"><span class="annottext">((ApiRequest -&gt; ApiResponse -&gt; ResolvedOperation -&gt; CheckResult)
 -&gt; Check)
-&gt; (ApiRequest -&gt; ApiResponse -&gt; ResolvedOperation -&gt; CheckResult)
-&gt; Check
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679242678"><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242678"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621679242679"><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242679"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621679242680"><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242680"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-71"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ResolvedOperation -&gt; Maybe ResponseSpec
</span><a href="Haskemathesis.Check.Standard.Helpers.html#responseSchemasForStatus"><span class="hs-identifier hs-var">responseSchemasForStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiResponse -&gt; Int
</span><a href="Haskemathesis.Execute.Types.html#resStatusCode"><span class="hs-identifier hs-var">resStatusCode</span></a></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242679"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242680"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-72"></span><span>            </span><span class="annot"><span class="annottext">Maybe ResponseSpec
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="Haskemathesis.Check.Types.html#CheckPassed"><span class="hs-identifier hs-var">CheckPassed</span></a></span><span>
</span><span id="line-73"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679242683"><span class="annot"><span class="annottext">ResponseSpec
</span><a href="#local-6989586621679242683"><span class="hs-identifier hs-var">responseSpec</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-74"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ResponseSpec -&gt; [(HeaderName, ByteString)] -&gt; [Text]
</span><a href="Haskemathesis.Check.Standard.Headers.html#validateResponseHeaders"><span class="hs-identifier hs-var">validateResponseHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseSpec
</span><a href="#local-6989586621679242683"><span class="hs-identifier hs-var">responseSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ApiResponse -&gt; [(HeaderName, ByteString)]
</span><a href="Haskemathesis.Execute.Types.html#resHeaders"><span class="hs-identifier hs-var">resHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242679"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-75"></span><span>                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CheckResult
</span><a href="Haskemathesis.Check.Types.html#CheckPassed"><span class="hs-identifier hs-var">CheckPassed</span></a></span><span>
</span><span id="line-76"></span><span>                    </span><span id="local-6989586621679242686"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242686"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-77"></span><span>                        </span><span class="annot"><span class="annottext">FailureDetail -&gt; CheckResult
</span><a href="Haskemathesis.Check.Types.html#CheckFailed"><span class="hs-identifier hs-var">CheckFailed</span></a></span><span>
</span><span id="line-78"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Text
-&gt; [Text]
-&gt; Maybe Text
-&gt; ApiRequest
-&gt; ApiResponse
-&gt; ResolvedOperation
-&gt; FailureDetail
</span><a href="Haskemathesis.Check.Standard.Helpers.html#failureDetail"><span class="hs-identifier hs-var">failureDetail</span></a></span><span>
</span><span id="line-79"></span><span>                                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;response_headers_conformance&quot;</span></span><span>
</span><span id="line-80"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;response headers invalid: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;; &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242686"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>                                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-82"></span><span>                                </span><span class="annot"><span class="annottext">Maybe Text
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-83"></span><span>                                </span><span class="annot"><span class="annottext">ApiRequest
</span><a href="#local-6989586621679242678"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-84"></span><span>                                </span><span class="annot"><span class="annottext">ApiResponse
</span><a href="#local-6989586621679242679"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-85"></span><span>                                </span><span class="annot"><span class="annottext">ResolvedOperation
</span><a href="#local-6989586621679242680"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-86"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#validateResponseHeaders"><span class="hs-identifier hs-type">validateResponseHeaders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Types.html#ResponseSpec"><span class="hs-identifier hs-type">ResponseSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.Header.html#HeaderName"><span class="hs-identifier hs-type">HeaderName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-89"></span><span id="validateResponseHeaders"><span class="annot"><span class="annottext">validateResponseHeaders :: ResponseSpec -&gt; [(HeaderName, ByteString)] -&gt; [Text]
</span><a href="Haskemathesis.Check.Standard.Headers.html#validateResponseHeaders"><span class="hs-identifier hs-var hs-var">validateResponseHeaders</span></a></span></span><span> </span><span id="local-6989586621679242689"><span class="annot"><span class="annottext">ResponseSpec
</span><a href="#local-6989586621679242689"><span class="hs-identifier hs-var">responseSpec</span></a></span></span><span> </span><span id="local-6989586621679242690"><span class="annot"><span class="annottext">[(HeaderName, ByteString)]
</span><a href="#local-6989586621679242690"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242691"><span class="hs-identifier hs-var">missingErrors</span></a></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242692"><span class="hs-identifier hs-var">schemaErrors</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621679242693"><span class="annot"><span class="annottext">headerValues :: Map Text (NonEmpty ByteString)
</span><a href="#local-6989586621679242693"><span class="hs-identifier hs-var hs-var">headerValues</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(HeaderName, ByteString)] -&gt; Map Text (NonEmpty ByteString)
</span><a href="Haskemathesis.Check.Standard.Headers.html#collectHeaderValues"><span class="hs-identifier hs-var">collectHeaderValues</span></a></span><span> </span><span class="annot"><span class="annottext">[(HeaderName, ByteString)]
</span><a href="#local-6989586621679242690"><span class="hs-identifier hs-var">headers</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621679242696"><span class="annot"><span class="annottext">missing :: [Text]
</span><a href="#local-6989586621679242696"><span class="hs-identifier hs-var hs-var">missing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; [Text] -&gt; [Text]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Map Text (NonEmpty ByteString) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-operator hs-var">`Map.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Map Text (NonEmpty ByteString)
</span><a href="#local-6989586621679242693"><span class="hs-identifier hs-var">headerValues</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeader"><span class="hs-identifier hs-var">normalizeHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResponseSpec -&gt; [Text]
</span><a href="Haskemathesis.OpenApi.Types.html#rsRequiredHeaders"><span class="hs-identifier hs-var">rsRequiredHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseSpec
</span><a href="#local-6989586621679242689"><span class="hs-identifier hs-var">responseSpec</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>    </span><span id="local-6989586621679242691"><span class="annot"><span class="annottext">missingErrors :: [Text]
</span><a href="#local-6989586621679242691"><span class="hs-identifier hs-var hs-var">missingErrors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;missing required header: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242702"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679242702"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242702"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242696"><span class="hs-identifier hs-var">missing</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-95"></span><span>    </span><span id="local-6989586621679242692"><span class="annot"><span class="annottext">schemaErrors :: [Text]
</span><a href="#local-6989586621679242692"><span class="hs-identifier hs-var hs-var">schemaErrors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>        </span><span class="annot"><span class="annottext">((Text, Schema) -&gt; [Text]) -&gt; [(Text, Schema)] -&gt; [Text]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text (NonEmpty ByteString) -&gt; (Text, Schema) -&gt; [Text]
</span><a href="Haskemathesis.Check.Standard.Headers.html#validateHeaderSchema"><span class="hs-identifier hs-var">validateHeaderSchema</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text (NonEmpty ByteString)
</span><a href="#local-6989586621679242693"><span class="hs-identifier hs-var">headerValues</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text Schema -&gt; [(Text, Schema)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Text Schema -&gt; Map Text Schema
</span><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeaderMap"><span class="hs-identifier hs-var">normalizeHeaderMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResponseSpec -&gt; Map Text Schema
</span><a href="Haskemathesis.OpenApi.Types.html#rsHeaders"><span class="hs-identifier hs-var">rsHeaders</span></a></span><span> </span><span class="annot"><span class="annottext">ResponseSpec
</span><a href="#local-6989586621679242689"><span class="hs-identifier hs-var">responseSpec</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#validateHeaderSchema"><span class="hs-identifier hs-type">validateHeaderSchema</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Haskemathesis.Schema.html#Schema"><span class="hs-identifier hs-type">Schema</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-99"></span><span id="validateHeaderSchema"><span class="annot"><span class="annottext">validateHeaderSchema :: Map Text (NonEmpty ByteString) -&gt; (Text, Schema) -&gt; [Text]
</span><a href="Haskemathesis.Check.Standard.Headers.html#validateHeaderSchema"><span class="hs-identifier hs-var hs-var">validateHeaderSchema</span></a></span></span><span> </span><span id="local-6989586621679242710"><span class="annot"><span class="annottext">Map Text (NonEmpty ByteString)
</span><a href="#local-6989586621679242710"><span class="hs-identifier hs-var">headerValues</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679242711"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242711"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242712"><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242712"><span class="hs-identifier hs-var">schema</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Map Text (NonEmpty ByteString) -&gt; Maybe (NonEmpty ByteString)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242711"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Map Text (NonEmpty ByteString)
</span><a href="#local-6989586621679242710"><span class="hs-identifier hs-var">headerValues</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><span class="annottext">Maybe (NonEmpty ByteString)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-102"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679242714"><span class="annot"><span class="annottext">NonEmpty ByteString
</span><a href="#local-6989586621679242714"><span class="hs-identifier hs-var">raws</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-103"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Schema -&gt; NonEmpty ByteString -&gt; Either Text Value
</span><a href="Haskemathesis.Check.Standard.Headers.html#headerValueToJson"><span class="hs-identifier hs-var">headerValueToJson</span></a></span><span> </span><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242712"><span class="hs-identifier hs-var">schema</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ByteString
</span><a href="#local-6989586621679242714"><span class="hs-identifier hs-var">raws</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-104"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679242716"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242716"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;header &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242711"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; invalid: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242716"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-105"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679242717"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242717"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Schema -&gt; Value -&gt; [Text]
</span><a href="Haskemathesis.Validate.html#validateErrors"><span class="hs-identifier hs-var">validateErrors</span></a></span><span> </span><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242712"><span class="hs-identifier hs-var">schema</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679242717"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-107"></span><span>                        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span>                        </span><span id="local-6989586621679242718"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242718"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-109"></span><span>                            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;header &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242711"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; violates schema: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679242718"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeaderMap"><span class="hs-identifier hs-type">normalizeHeaderMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="Haskemathesis.Schema.html#Schema"><span class="hs-identifier hs-type">Schema</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="Haskemathesis.Schema.html#Schema"><span class="hs-identifier hs-type">Schema</span></a></span><span>
</span><span id="line-112"></span><span id="normalizeHeaderMap"><span class="annot"><span class="annottext">normalizeHeaderMap :: Map Text Schema -&gt; Map Text Schema
</span><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeaderMap"><span class="hs-identifier hs-var hs-var">normalizeHeaderMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Map Text Schema -&gt; Map Text Schema
forall a. (Text -&gt; Text) -&gt; Map Text a -&gt; Map Text a
</span><a href="Haskemathesis.Check.Standard.Helpers.html#normalizeMapKeys"><span class="hs-identifier hs-var">normalizeMapKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeader"><span class="hs-identifier hs-var">normalizeHeader</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#headerValueToJson"><span class="hs-identifier hs-type">headerValueToJson</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Schema.html#Schema"><span class="hs-identifier hs-type">Schema</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-115"></span><span id="headerValueToJson"><span class="annot"><span class="annottext">headerValueToJson :: Schema -&gt; NonEmpty ByteString -&gt; Either Text Value
</span><a href="Haskemathesis.Check.Standard.Headers.html#headerValueToJson"><span class="hs-identifier hs-var hs-var">headerValueToJson</span></a></span></span><span> </span><span id="local-6989586621679242719"><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242719"><span class="hs-identifier hs-var">schema</span></a></span></span><span> </span><span id="local-6989586621679242720"><span class="annot"><span class="annottext">NonEmpty ByteString
</span><a href="#local-6989586621679242720"><span class="hs-identifier hs-var">raws</span></a></span></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Schema -&gt; Maybe SchemaType
</span><a href="Haskemathesis.Schema.html#schemaType"><span class="hs-identifier hs-var">schemaType</span></a></span><span> </span><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242719"><span class="hs-identifier hs-var">schema</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SchemaType -&gt; Maybe SchemaType -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SchemaType -&gt; Maybe SchemaType
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">SchemaType
</span><a href="Haskemathesis.Schema.html#SArray"><span class="hs-identifier hs-var">SArray</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Schema -&gt; NonEmpty ByteString -&gt; Either Text Value
</span><a href="Haskemathesis.Check.Standard.Headers.html#parseArray"><span class="hs-identifier hs-var">parseArray</span></a></span><span> </span><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242719"><span class="hs-identifier hs-var">schema</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ByteString
</span><a href="#local-6989586621679242720"><span class="hs-identifier hs-var">raws</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Schema -&gt; ByteString -&gt; Either Text Value
</span><a href="Haskemathesis.Check.Standard.Headers.html#parseScalar"><span class="hs-identifier hs-var">parseScalar</span></a></span><span> </span><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242719"><span class="hs-identifier hs-var">schema</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty ByteString -&gt; ByteString
forall a. NonEmpty a -&gt; a
</span><span class="hs-identifier hs-var">NE.head</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ByteString
</span><a href="#local-6989586621679242720"><span class="hs-identifier hs-var">raws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><span class="hs-comment">-- | Parse a header value as an array.</span></span><span>
</span><span id="line-120"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#parseArray"><span class="hs-identifier hs-type">parseArray</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Schema.html#Schema"><span class="hs-identifier hs-type">Schema</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-121"></span><span id="parseArray"><span class="annot"><span class="annottext">parseArray :: Schema -&gt; NonEmpty ByteString -&gt; Either Text Value
</span><a href="Haskemathesis.Check.Standard.Headers.html#parseArray"><span class="hs-identifier hs-var hs-var">parseArray</span></a></span></span><span> </span><span id="local-6989586621679242726"><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242726"><span class="hs-identifier hs-var">schema</span></a></span></span><span> </span><span id="local-6989586621679242727"><span class="annot"><span class="annottext">NonEmpty ByteString
</span><a href="#local-6989586621679242727"><span class="hs-identifier hs-var">values</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">Array -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="annot"><span class="annottext">(Array -&gt; Value) -&gt; ([Value] -&gt; Array) -&gt; [Value] -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Value] -&gt; Array
forall a. [a] -&gt; Vector a
</span><span class="hs-identifier hs-var">Vector.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Value] -&gt; Value) -&gt; Either Text [Value] -&gt; Either Text Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either Text Value)
-&gt; [ByteString] -&gt; Either Text [Value]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Schema -&gt; ByteString -&gt; Either Text Value
</span><a href="Haskemathesis.Check.Standard.Headers.html#parseScalar"><span class="hs-identifier hs-var">parseScalar</span></a></span><span> </span><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242733"><span class="hs-identifier hs-var">itemSchema</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679242734"><span class="hs-identifier hs-var">items</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679242733"><span class="annot"><span class="annottext">itemSchema :: Schema
</span><a href="#local-6989586621679242733"><span class="hs-identifier hs-var hs-var">itemSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Schema -&gt; Maybe Schema -&gt; Schema
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Schema
</span><a href="Haskemathesis.Schema.html#emptySchema"><span class="hs-identifier hs-var">emptySchema</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Schema -&gt; Maybe Schema
</span><a href="Haskemathesis.Schema.html#schemaItems"><span class="hs-identifier hs-var">schemaItems</span></a></span><span> </span><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242726"><span class="hs-identifier hs-var">schema</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span id="local-6989586621679242734"><span class="annot"><span class="annottext">items :: [ByteString]
</span><a href="#local-6989586621679242734"><span class="hs-identifier hs-var hs-var">items</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NonEmpty ByteString
</span><a href="#local-6989586621679242727"><span class="hs-identifier hs-var">values</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-126"></span><span>        </span><span id="local-6989586621679242736"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679242736"><span class="hs-identifier hs-var">single</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><a href="Haskemathesis.Check.Standard.Headers.html#splitCommaValues"><span class="hs-identifier hs-var">splitCommaValues</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679242736"><span class="hs-identifier hs-var">single</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span id="local-6989586621679242739"><span class="annot"><span class="annottext">NonEmpty ByteString
</span><a href="#local-6989586621679242739"><span class="hs-identifier hs-var">multiple</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NonEmpty ByteString -&gt; [ByteString]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NE.toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ByteString
</span><a href="#local-6989586621679242739"><span class="hs-identifier hs-var">multiple</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#parseScalar"><span class="hs-identifier hs-type">parseScalar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Haskemathesis.Schema.html#Schema"><span class="hs-identifier hs-type">Schema</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-130"></span><span id="parseScalar"><span class="annot"><span class="annottext">parseScalar :: Schema -&gt; ByteString -&gt; Either Text Value
</span><a href="Haskemathesis.Check.Standard.Headers.html#parseScalar"><span class="hs-identifier hs-var hs-var">parseScalar</span></a></span></span><span> </span><span id="local-6989586621679242741"><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242741"><span class="hs-identifier hs-var">schema</span></a></span></span><span> </span><span id="local-6989586621679242742"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679242742"><span class="hs-identifier hs-var">raw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Schema -&gt; Maybe SchemaType
</span><a href="Haskemathesis.Schema.html#schemaType"><span class="hs-identifier hs-var">schemaType</span></a></span><span> </span><span class="annot"><span class="annottext">Schema
</span><a href="#local-6989586621679242741"><span class="hs-identifier hs-var">schema</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">SchemaType
</span><a href="Haskemathesis.Schema.html#SInteger"><span class="hs-identifier hs-var">SInteger</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; Maybe Value) -&gt; Either Text Value
forall {a} {b}. a -&gt; (Text -&gt; Maybe b) -&gt; Either a b
</span><a href="#local-6989586621679242744"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;expected integer&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Value
</span><a href="#local-6989586621679242745"><span class="hs-identifier hs-var">readInteger</span></a></span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">SchemaType
</span><a href="Haskemathesis.Schema.html#SNumber"><span class="hs-identifier hs-var">SNumber</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; Maybe Value) -&gt; Either Text Value
forall {a} {b}. a -&gt; (Text -&gt; Maybe b) -&gt; Either a b
</span><a href="#local-6989586621679242744"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;expected number&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Value
</span><a href="#local-6989586621679242747"><span class="hs-identifier hs-var">readNumber</span></a></span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">SchemaType
</span><a href="Haskemathesis.Schema.html#SBoolean"><span class="hs-identifier hs-var">SBoolean</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Text Value
</span><a href="#local-6989586621679242749"><span class="hs-identifier hs-var">parseBool</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">SchemaType
</span><a href="Haskemathesis.Schema.html#SNull"><span class="hs-identifier hs-var">SNull</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.strip</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242752"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either Text Value
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">Null</span></a></span><span>
</span><span id="line-136"></span><span>        </span><span id="local-6989586621679242754"><span class="annot"><span class="annottext">Maybe SchemaType
</span><a href="#local-6989586621679242754"><span class="hs-identifier hs-var">_otherType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either Text Value
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242752"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621679242752"><span class="annot"><span class="annottext">txt :: Text
</span><a href="#local-6989586621679242752"><span class="hs-identifier hs-var hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeaderValue"><span class="hs-identifier hs-var">normalizeHeaderValue</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679242742"><span class="hs-identifier hs-var">raw</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621679242744"><span class="annot"><span class="annottext">parse :: a -&gt; (Text -&gt; Maybe b) -&gt; Either a b
</span><a href="#local-6989586621679242744"><span class="hs-identifier hs-var hs-var">parse</span></a></span></span><span> </span><span id="local-6989586621679242757"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679242757"><span class="hs-identifier hs-var">errMsg</span></a></span></span><span> </span><span id="local-6989586621679242758"><span class="annot"><span class="annottext">Text -&gt; Maybe b
</span><a href="#local-6989586621679242758"><span class="hs-identifier hs-var">reader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either a b -&gt; (b -&gt; Either a b) -&gt; Maybe b -&gt; Either a b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either a b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679242757"><span class="hs-identifier hs-var">errMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b -&gt; Either a b
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe b
</span><a href="#local-6989586621679242758"><span class="hs-identifier hs-var">reader</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242752"><span class="hs-identifier hs-var">txt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621679242745"><span class="annot"><span class="annottext">readInteger :: Text -&gt; Maybe Value
</span><a href="#local-6989586621679242745"><span class="hs-identifier hs-var hs-var">readInteger</span></a></span></span><span> </span><span id="local-6989586621679242768"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242768"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Number"><span class="hs-identifier hs-var">Number</span></a></span><span> </span><span class="annot"><span class="annottext">(Scientific -&gt; Value)
-&gt; (Integer -&gt; Scientific) -&gt; Integer -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Scientific
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Value) -&gt; Maybe Integer -&gt; Maybe Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe Integer
forall a. Read a =&gt; String -&gt; Maybe a
</span><span class="hs-identifier hs-var">readMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242768"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679242747"><span class="annot"><span class="annottext">readNumber :: Text -&gt; Maybe Value
</span><a href="#local-6989586621679242747"><span class="hs-identifier hs-var hs-var">readNumber</span></a></span></span><span> </span><span id="local-6989586621679242776"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242776"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Number"><span class="hs-identifier hs-var">Number</span></a></span><span> </span><span class="annot"><span class="annottext">(Scientific -&gt; Value) -&gt; (Double -&gt; Scientific) -&gt; Double -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Scientific
forall a. RealFloat a =&gt; a -&gt; Scientific
</span><a href="file:///nix/store/hwr0895a4mk8gp1c52mqxqwygppa2imi-scientific-0.3.8.0-doc/share/doc/scientific-0.3.8.0/html/src/Data.Scientific.html#fromFloatDigits"><span class="hs-identifier hs-var">fromFloatDigits</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; Value) -&gt; Maybe Double -&gt; Maybe Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe Double
forall a. Read a =&gt; String -&gt; Maybe a
</span><span class="hs-identifier hs-var">readMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242776"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621679242749"><span class="annot"><span class="annottext">parseBool :: Either Text Value
</span><a href="#local-6989586621679242749"><span class="hs-identifier hs-var hs-var">parseBool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toLower</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242752"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;true&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either Text Value
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;false&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either Text Value
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Value
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;expected boolean&quot;</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeaderValue"><span class="hs-identifier hs-type">normalizeHeaderValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-148"></span><span id="normalizeHeaderValue"><span class="annot"><span class="annottext">normalizeHeaderValue :: ByteString -&gt; Text
</span><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeaderValue"><span class="hs-identifier hs-var hs-var">normalizeHeaderValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Haskemathesis.Check.Standard.Headers.html#stripQuotes"><span class="hs-identifier hs-var">stripQuotes</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.strip</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (ByteString -&gt; Text) -&gt; ByteString -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">decodeUtf8</span></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#stripQuotes"><span class="hs-identifier hs-type">stripQuotes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-151"></span><span id="stripQuotes"><span class="annot"><span class="annottext">stripQuotes :: Text -&gt; Text
</span><a href="Haskemathesis.Check.Standard.Headers.html#stripQuotes"><span class="hs-identifier hs-var hs-var">stripQuotes</span></a></span></span><span> </span><span id="local-6989586621679242785"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242785"><span class="hs-identifier hs-var">txt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe (Char, Text)
</span><span class="hs-identifier hs-var">T.uncons</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242785"><span class="hs-identifier hs-var">txt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-153"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'&quot;'</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242787"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242787"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.isSuffixOf</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242787"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.dropEnd</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242787"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242790"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242790"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.isSuffixOf</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242790"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text -&gt; Text
</span><span class="hs-identifier hs-var">T.dropEnd</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242790"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span id="local-6989586621679242791"><span class="annot"><span class="annottext">Maybe (Char, Text)
</span><a href="#local-6989586621679242791"><span class="hs-identifier hs-var">_unquoted</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679242785"><span class="hs-identifier hs-var">txt</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#splitCommaValues"><span class="hs-identifier hs-type">splitCommaValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">]</span><span>
</span><span id="line-158"></span><span id="splitCommaValues"><span class="annot"><span class="annottext">splitCommaValues :: ByteString -&gt; [ByteString]
</span><a href="Haskemathesis.Check.Standard.Headers.html#splitCommaValues"><span class="hs-identifier hs-var hs-var">splitCommaValues</span></a></span></span><span> </span><span id="local-6989586621679242792"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679242792"><span class="hs-identifier hs-var">raw</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-159"></span><span>    </span><span class="annot"><span class="annottext">(Text -&gt; ByteString) -&gt; [Text] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeUtf8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; [Text] -&gt; [Text]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Text -&gt; Bool) -&gt; Text -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.null</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; [Text] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.strip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Text -&gt; Text -&gt; [Text]
Text -&gt; Text -&gt; [Text]
</span><span class="hs-identifier hs-var">T.splitOn</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">decodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679242792"><span class="hs-identifier hs-var">raw</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#collectHeaderValues"><span class="hs-identifier hs-type">collectHeaderValues</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/fsi2cvnm3mdngjk22hkkpyl0q5h66sjj-http-types-0.12.4-doc/share/doc/http-types-0.12.4/html/src/Network.HTTP.Types.Header.html#HeaderName"><span class="hs-identifier hs-type">HeaderName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span id="collectHeaderValues"><span class="annot"><span class="annottext">collectHeaderValues :: [(HeaderName, ByteString)] -&gt; Map Text (NonEmpty ByteString)
</span><a href="Haskemathesis.Check.Standard.Headers.html#collectHeaderValues"><span class="hs-identifier hs-var hs-var">collectHeaderValues</span></a></span></span><span> </span><span id="local-6989586621679242796"><span class="annot"><span class="annottext">[(HeaderName, ByteString)]
</span><a href="#local-6989586621679242796"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">(NonEmpty ByteString -&gt; NonEmpty ByteString -&gt; NonEmpty ByteString)
-&gt; [(Text, NonEmpty ByteString)] -&gt; Map Text (NonEmpty ByteString)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ByteString -&gt; NonEmpty ByteString -&gt; NonEmpty ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((HeaderName, ByteString) -&gt; (Text, NonEmpty ByteString))
-&gt; [(HeaderName, ByteString)] -&gt; [(Text, NonEmpty ByteString)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(HeaderName, ByteString) -&gt; (Text, NonEmpty ByteString)
forall {a}. (HeaderName, a) -&gt; (Text, NonEmpty a)
</span><a href="#local-6989586621679242798"><span class="hs-identifier hs-var">normalize</span></a></span><span> </span><span class="annot"><span class="annottext">[(HeaderName, ByteString)]
</span><a href="#local-6989586621679242796"><span class="hs-identifier hs-var">headers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621679242798"><span class="annot"><span class="annottext">normalize :: (HeaderName, a) -&gt; (Text, NonEmpty a)
</span><a href="#local-6989586621679242798"><span class="hs-identifier hs-var hs-var">normalize</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679242799"><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679242799"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679242800"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679242800"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeader"><span class="hs-identifier hs-var">normalizeHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">decodeUtf8</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderName -&gt; ByteString
forall s. CI s -&gt; s
</span><a href="file:///nix/store/j3bcnc7r5q4sz7xij5naq8pf2zh1xr44-case-insensitive-1.2.1.0-doc/share/doc/case-insensitive-1.2.1.0/html/src/Data.CaseInsensitive.Internal.html#original"><span class="hs-identifier hs-var">CI.original</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderName
</span><a href="#local-6989586621679242799"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679242800"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; NonEmpty a
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="annot"><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeader"><span class="hs-identifier hs-type">normalizeHeader</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-169"></span><span id="normalizeHeader"><span class="annot"><span class="annottext">normalizeHeader :: Text -&gt; Text
</span><a href="Haskemathesis.Check.Standard.Headers.html#normalizeHeader"><span class="hs-identifier hs-var hs-var">normalizeHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toLower</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Text -&gt; Text) -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.strip</span></span><span>
</span><span id="line-170"></span></pre></body></html>