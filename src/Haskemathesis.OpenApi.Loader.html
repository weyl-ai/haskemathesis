<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE StrictData #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">{- | Load OpenAPI specs from YAML or JSON files.

This module provides functions for loading OpenAPI specifications
from disk. It supports both YAML and JSON formats, automatically
detecting the format based on file extension and content.

=== Basic Usage

Load a specification from a file:

@
import Haskemathesis.OpenApi.Loader (loadOpenApiFile)

main :: IO ()
main = do
    result &lt;- loadOpenApiFile &quot;api.yaml&quot;
    case result of
        Left err -&gt; putStrLn $ &quot;Failed to load: &quot; ++ show err
        Right spec -&gt; putStrLn &quot;Loaded successfully!&quot;
@

=== Error Handling

The loader returns 'Either Text OpenApi', where the Left case
contains a descriptive error message if parsing fails. This
can happen due to:

* File not found or unreadable
* Invalid YAML/JSON syntax
* Invalid OpenAPI structure (validation errors)

=== Supported Formats

* YAML files (.yaml, .yml extension)
* JSON files (.json extension)
* Files without extension (auto-detected by content)

=== OpenAPI 3.1 Support

This loader automatically transforms OpenAPI 3.1 constructs to
their OpenAPI 3.0 equivalents before parsing. This includes:

* @exclusiveMinimum: \&lt;number\&gt;@ &#8594; @minimum: \&lt;number\&gt;, exclusiveMinimum: true@
* @exclusiveMaximum: \&lt;number\&gt;@ &#8594; @maximum: \&lt;number\&gt;, exclusiveMaximum: true@

This allows specs written for OpenAPI 3.1 (which uses JSON Schema 2020-12)
to be loaded by the openapi3 library which only supports OpenAPI 3.0.
-}</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html"><span class="hs-identifier">Haskemathesis.OpenApi.Loader</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#loadOpenApiFile"><span class="hs-identifier">loadOpenApiFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#loadOpenApiFileWithExtensions"><span class="hs-identifier">loadOpenApiFileWithExtensions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationExtensions"><span class="hs-identifier">OperationExtensions</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationKey"><span class="hs-identifier">OperationKey</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Internal (exported for testing)</span></span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#transformOpenApi31To30"><span class="hs-identifier">transformOpenApi31To30</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#extractOperationExtensions"><span class="hs-identifier">extractOperationExtensions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">where</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Result"><span class="hs-identifier">Result</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier">Value</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.FromJSON.html#fromJSON"><span class="hs-identifier">fromJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Key.html"><span class="hs-identifier">Data.Aeson.Key</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Key.html#Key"><span class="hs-identifier">Key</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Key.html"><span class="hs-identifier">Data.Aeson.Key</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Key</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html"><span class="hs-identifier">Data.Aeson.KeyMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">KM</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/n9bq8nyqbcrs9rhllk8bh2xqlhba601s-openapi3-3.2.4-doc/share/doc/openapi3-3.2.4/html/src/Data.OpenApi.html"><span class="hs-identifier">Data.OpenApi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n9bq8nyqbcrs9rhllk8bh2xqlhba601s-openapi3-3.2.4-doc/share/doc/openapi3-3.2.4/html/src/Data.OpenApi.Internal.html#OpenApi"><span class="hs-identifier">OpenApi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/hwr0895a4mk8gp1c52mqxqwygppa2imi-scientific-0.3.8.0-doc/share/doc/scientific-0.3.8.0/html/src/Data.Scientific.html"><span class="hs-identifier">Data.Scientific</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/hwr0895a4mk8gp1c52mqxqwygppa2imi-scientific-0.3.8.0-doc/share/doc/scientific-0.3.8.0/html/src/Data.Scientific.html#isInteger"><span class="hs-identifier">isInteger</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/hwr0895a4mk8gp1c52mqxqwygppa2imi-scientific-0.3.8.0-doc/share/doc/scientific-0.3.8.0/html/src/Data.Scientific.html#toBoundedInteger"><span class="hs-identifier">toBoundedInteger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/5yy64md1ny6jpffrkgsq9gn90diwkshl-yaml-0.11.11.2-doc/share/doc/yaml-0.11.11.2/html/src/Data.Yaml.html"><span class="hs-identifier">Data.Yaml</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/5yy64md1ny6jpffrkgsq9gn90diwkshl-yaml-0.11.11.2-doc/share/doc/yaml-0.11.11.2/html/src/Data.Yaml.html#decodeFileEither"><span class="hs-identifier">decodeFileEither</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/5yy64md1ny6jpffrkgsq9gn90diwkshl-yaml-0.11.11.2-doc/share/doc/yaml-0.11.11.2/html/src/Data.Yaml.Internal.html#prettyPrintParseException"><span class="hs-identifier">prettyPrintParseException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><span class="hs-comment">{- | Load an OpenAPI specification from a file.

This function reads a YAML or JSON file and parses it into an
'OpenApi' value. It automatically detects the file format.

OpenAPI 3.1 specs are automatically transformed to OpenAPI 3.0
format before parsing, allowing compatibility with the openapi3 library.

=== Parameters

* @path@ - Path to the OpenAPI specification file

=== Return Value

Returns 'Right OpenApi' on success, or 'Left Text' with an error
message on failure.

=== Example

@
main :: IO ()
main = do
    result &lt;- loadOpenApiFile &quot;specs/api.yaml&quot;
    case result of
        Left err -&gt; putStrLn $ &quot;Error: &quot; ++ T.unpack err
        Right spec -&gt; do
            putStrLn $ &quot;Loaded API with &quot; ++ show (length spec) ++ &quot; paths&quot;
@
-}</span></span><span>
</span><span id="line-106"></span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#loadOpenApiFile"><span class="hs-identifier hs-type">loadOpenApiFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="file:///nix/store/n9bq8nyqbcrs9rhllk8bh2xqlhba601s-openapi3-3.2.4-doc/share/doc/openapi3-3.2.4/html/src/Data.OpenApi.Internal.html#OpenApi"><span class="hs-identifier hs-type">OpenApi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span id="loadOpenApiFile"><span class="annot"><span class="annottext">loadOpenApiFile :: FilePath -&gt; IO (Either Text OpenApi)
</span><a href="Haskemathesis.OpenApi.Loader.html#loadOpenApiFile"><span class="hs-identifier hs-var hs-var">loadOpenApiFile</span></a></span></span><span> </span><span id="local-6989586621679220997"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679220997"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-comment">-- First parse as raw Value to allow transformation</span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679220998"><span class="annot"><a href="#local-6989586621679220998"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Either ParseException Value)
forall a. FromJSON a =&gt; FilePath -&gt; IO (Either ParseException a)
</span><a href="file:///nix/store/5yy64md1ny6jpffrkgsq9gn90diwkshl-yaml-0.11.11.2-doc/share/doc/yaml-0.11.11.2/html/src/Data.Yaml.html#decodeFileEither"><span class="hs-identifier hs-var">decodeFileEither</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679220997"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679220998"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679220999"><span class="annot"><span class="annottext">ParseException
</span><a href="#local-6989586621679220999"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text OpenApi
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParseException -&gt; FilePath
</span><a href="file:///nix/store/5yy64md1ny6jpffrkgsq9gn90diwkshl-yaml-0.11.11.2-doc/share/doc/yaml-0.11.11.2/html/src/Data.Yaml.Internal.html#prettyPrintParseException"><span class="hs-identifier hs-var">prettyPrintParseException</span></a></span><span> </span><span class="annot"><span class="annottext">ParseException
</span><a href="#local-6989586621679220999"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679221001"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679221001"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>            </span><span class="hs-comment">-- Transform 3.1 constructs to 3.0, then decode to OpenApi</span><span>
</span><span id="line-114"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679221002"><span class="annot"><span class="annottext">transformed :: Value
</span><a href="#local-6989586621679221002"><span class="hs-identifier hs-var hs-var">transformed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="Haskemathesis.OpenApi.Loader.html#transformOpenApi31To30"><span class="hs-identifier hs-var">transformOpenApi31To30</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679221001"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-115"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Result OpenApi
forall a. FromJSON a =&gt; Value -&gt; Result a
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.FromJSON.html#fromJSON"><span class="hs-identifier hs-var">fromJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679221002"><span class="hs-identifier hs-var">transformed</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-116"></span><span>                    </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621679221004"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679221004"><span class="hs-identifier hs-var">err'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text OpenApi
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679221004"><span class="hs-identifier hs-var">err'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>                    </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621679221006"><span class="annot"><span class="annottext">OpenApi
</span><a href="#local-6989586621679221006"><span class="hs-identifier hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OpenApi -&gt; Either Text OpenApi
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">OpenApi
</span><a href="#local-6989586621679221006"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><span class="hs-comment">{- | Transform OpenAPI 3.1 JSON Schema constructs to OpenAPI 3.0 equivalents.

This function recursively walks the JSON structure and transforms:

* OpenAPI version @3.1.x@ to @3.0.3@ (highest supported by openapi3 library)
* Numeric @exclusiveMinimum@ to @minimum@ + boolean @exclusiveMinimum: true@
* Numeric @exclusiveMaximum@ to @maximum@ + boolean @exclusiveMaximum: true@

This allows OpenAPI 3.1 specs (which use JSON Schema 2020-12 semantics)
to be parsed by libraries that only support OpenAPI 3.0 (JSON Schema draft-04).
-}</span></span><span>
</span><span id="line-130"></span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#transformOpenApi31To30"><span class="hs-identifier hs-type">transformOpenApi31To30</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-131"></span><span id="transformOpenApi31To30"><span class="annot"><span class="annottext">transformOpenApi31To30 :: Value -&gt; Value
</span><a href="Haskemathesis.OpenApi.Loader.html#transformOpenApi31To30"><span class="hs-identifier hs-var hs-var">transformOpenApi31To30</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="#local-6989586621679221007"><span class="hs-identifier hs-var">transformValue</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><a href="#local-6989586621679221007"><span class="hs-identifier hs-type">transformValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679221007"><span class="annot"><span class="annottext">transformValue :: Value -&gt; Value
</span><a href="#local-6989586621679221007"><span class="hs-identifier hs-var hs-var">transformValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679221009"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221009"><span class="hs-identifier hs-var">obj</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Object -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-var">Object</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Object -&gt; Object
</span><a href="#local-6989586621679221010"><span class="hs-identifier hs-var">transformObject</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221009"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="#local-6989586621679221007"><span class="hs-identifier hs-var">transformValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Array"><span class="hs-identifier hs-type">Array</span></a></span><span> </span><span id="local-6989586621679221012"><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679221012"><span class="hs-identifier hs-var">arr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Array -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Array"><span class="hs-identifier hs-var">Array</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; Array -&gt; Array
forall a b. (a -&gt; b) -&gt; Vector a -&gt; Vector b
</span><span class="hs-identifier hs-var">V.map</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="#local-6989586621679221007"><span class="hs-identifier hs-var">transformValue</span></a></span><span> </span><span class="annot"><span class="annottext">Array
</span><a href="#local-6989586621679221012"><span class="hs-identifier hs-var">arr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="#local-6989586621679221007"><span class="hs-identifier hs-var">transformValue</span></a></span><span> </span><span id="local-6989586621679221014"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679221014"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679221014"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>    </span><span class="annot"><a href="#local-6989586621679221010"><span class="hs-identifier hs-type">transformObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621679221010"><span class="annot"><span class="annottext">transformObject :: Object -&gt; Object
</span><a href="#local-6989586621679221010"><span class="hs-identifier hs-var hs-var">transformObject</span></a></span></span><span> </span><span id="local-6989586621679221015"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221015"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-141"></span><span>            </span><span class="hs-comment">-- First recursively transform all nested values</span><span>
</span><span id="line-142"></span><span>            </span><span id="local-6989586621679221016"><span class="annot"><span class="annottext">recursed :: Object
</span><a href="#local-6989586621679221016"><span class="hs-identifier hs-var hs-var">recursed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Value) -&gt; Object -&gt; Object
forall a b. (a -&gt; b) -&gt; KeyMap a -&gt; KeyMap b
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#map"><span class="hs-identifier hs-var">KM.map</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="#local-6989586621679221007"><span class="hs-identifier hs-var">transformValue</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221015"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-143"></span><span>            </span><span class="hs-comment">-- Transform OpenAPI version 3.1.x to 3.0.3</span><span>
</span><span id="line-144"></span><span>            </span><span id="local-6989586621679221018"><span class="annot"><span class="annottext">withVersion :: Object
</span><a href="#local-6989586621679221018"><span class="hs-identifier hs-var hs-var">withVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Object -&gt; Object
</span><a href="#local-6989586621679221019"><span class="hs-identifier hs-var">transformOpenapiVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221016"><span class="hs-identifier hs-var">recursed</span></a></span><span>
</span><span id="line-145"></span><span>            </span><span class="hs-comment">-- Then apply exclusiveMinimum/Maximum transformations</span><span>
</span><span id="line-146"></span><span>            </span><span id="local-6989586621679221020"><span class="annot"><span class="annottext">withExclMin :: Object
</span><a href="#local-6989586621679221020"><span class="hs-identifier hs-var hs-var">withExclMin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Object -&gt; Object
</span><a href="#local-6989586621679221021"><span class="hs-identifier hs-var">transformExclusiveMinimum</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221018"><span class="hs-identifier hs-var">withVersion</span></a></span><span>
</span><span id="line-147"></span><span>            </span><span id="local-6989586621679221022"><span class="annot"><span class="annottext">withExclMax :: Object
</span><a href="#local-6989586621679221022"><span class="hs-identifier hs-var hs-var">withExclMax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Object -&gt; Object
</span><a href="#local-6989586621679221023"><span class="hs-identifier hs-var">transformExclusiveMaximum</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221020"><span class="hs-identifier hs-var">withExclMin</span></a></span><span>
</span><span id="line-148"></span><span>         </span><span class="hs-keyword">in</span><span>
</span><span id="line-149"></span><span>            </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221022"><span class="hs-identifier hs-var">withExclMax</span></a></span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-comment">-- Transform openapi: &quot;3.1.x&quot; to &quot;3.0.3&quot;</span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><a href="#local-6989586621679221019"><span class="hs-identifier hs-type">transformOpenapiVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679221019"><span class="annot"><span class="annottext">transformOpenapiVersion :: Object -&gt; Object
</span><a href="#local-6989586621679221019"><span class="hs-identifier hs-var hs-var">transformOpenapiVersion</span></a></span></span><span> </span><span id="local-6989586621679221024"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221024"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#lookup"><span class="hs-identifier hs-var">KM.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221026"><span class="hs-identifier hs-var">openapiKey</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221024"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-155"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span id="local-6989586621679221028"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679221028"><span class="hs-identifier hs-var">ver</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.isPrefixOf</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;3.1&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679221028"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>                    </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; Object -&gt; Object
forall v. Key -&gt; v -&gt; KeyMap v -&gt; KeyMap v
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#insert"><span class="hs-identifier hs-var">KM.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221026"><span class="hs-identifier hs-var">openapiKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#String"><span class="hs-identifier hs-var">String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;3.0.3&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221024"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-158"></span><span>            </span><span id="local-6989586621679221031"><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621679221031"><span class="hs-identifier hs-var">_notOpenApi31</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221024"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-comment">-- Transform exclusive&lt;Bound&gt;: &lt;number&gt; to &lt;bound&gt;: &lt;number&gt;, exclusive&lt;Bound&gt;: true</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><a href="#local-6989586621679221032"><span class="hs-identifier hs-type">transformExclusiveBound</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679221032"><span class="annot"><span class="annottext">transformExclusiveBound :: Key -&gt; Key -&gt; Object -&gt; Object
</span><a href="#local-6989586621679221032"><span class="hs-identifier hs-var hs-var">transformExclusiveBound</span></a></span></span><span> </span><span id="local-6989586621679221033"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221033"><span class="hs-identifier hs-var">exclusiveKey</span></a></span></span><span> </span><span id="local-6989586621679221034"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221034"><span class="hs-identifier hs-var">boundKey</span></a></span></span><span> </span><span id="local-6989586621679221035"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221035"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#lookup"><span class="hs-identifier hs-var">KM.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221033"><span class="hs-identifier hs-var">exclusiveKey</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221035"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-164"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Number"><span class="hs-identifier hs-type">Number</span></a></span><span> </span><span id="local-6989586621679221037"><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679221037"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Bool
</span><a href="file:///nix/store/hwr0895a4mk8gp1c52mqxqwygppa2imi-scientific-0.3.8.0-doc/share/doc/scientific-0.3.8.0/html/src/Data.Scientific.html#isInteger"><span class="hs-identifier hs-var">isInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679221037"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>                    </span><span class="hs-comment">-- Remove the numeric exclusive bound</span><span>
</span><span id="line-167"></span><span>                    </span><span class="hs-comment">-- Add bound with the value, and exclusive bound: true</span><span>
</span><span id="line-168"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679221039"><span class="annot"><span class="annottext">withoutOld :: Object
</span><a href="#local-6989586621679221039"><span class="hs-identifier hs-var hs-var">withoutOld</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Object
forall v. Key -&gt; KeyMap v -&gt; KeyMap v
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#delete"><span class="hs-identifier hs-var">KM.delete</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221033"><span class="hs-identifier hs-var">exclusiveKey</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221035"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-169"></span><span>                        </span><span id="local-6989586621679221041"><span class="annot"><span class="annottext">withBound :: Object
</span><a href="#local-6989586621679221041"><span class="hs-identifier hs-var hs-var">withBound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; Object -&gt; Object
forall v. Key -&gt; v -&gt; KeyMap v -&gt; KeyMap v
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#insert"><span class="hs-identifier hs-var">KM.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221034"><span class="hs-identifier hs-var">boundKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scientific -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Number"><span class="hs-identifier hs-var">Number</span></a></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679221037"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221039"><span class="hs-identifier hs-var">withoutOld</span></a></span><span>
</span><span id="line-170"></span><span>                        </span><span id="local-6989586621679221042"><span class="annot"><span class="annottext">withExcl :: Object
</span><a href="#local-6989586621679221042"><span class="hs-identifier hs-var hs-var">withExcl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; Object -&gt; Object
forall v. Key -&gt; v -&gt; KeyMap v -&gt; KeyMap v
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#insert"><span class="hs-identifier hs-var">KM.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221033"><span class="hs-identifier hs-var">exclusiveKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Value
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Bool"><span class="hs-identifier hs-var">Bool</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221041"><span class="hs-identifier hs-var">withBound</span></a></span><span>
</span><span id="line-171"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221042"><span class="hs-identifier hs-var">withExcl</span></a></span><span>
</span><span id="line-172"></span><span>            </span><span id="local-6989586621679221044"><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621679221044"><span class="hs-identifier hs-var">_notNumericExcl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221035"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><a href="#local-6989586621679221021"><span class="hs-identifier hs-type">transformExclusiveMinimum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621679221021"><span class="annot"><span class="annottext">transformExclusiveMinimum :: Object -&gt; Object
</span><a href="#local-6989586621679221021"><span class="hs-identifier hs-var hs-var">transformExclusiveMinimum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Key -&gt; Object -&gt; Object
</span><a href="#local-6989586621679221032"><span class="hs-identifier hs-var">transformExclusiveBound</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;exclusiveMinimum&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;minimum&quot;</span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><a href="#local-6989586621679221023"><span class="hs-identifier hs-type">transformExclusiveMaximum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621679221023"><span class="annot"><span class="annottext">transformExclusiveMaximum :: Object -&gt; Object
</span><a href="#local-6989586621679221023"><span class="hs-identifier hs-var hs-var">transformExclusiveMaximum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Key -&gt; Object -&gt; Object
</span><a href="#local-6989586621679221032"><span class="hs-identifier hs-var">transformExclusiveBound</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;exclusiveMaximum&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;maximum&quot;</span></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="#local-6989586621679221026"><span class="hs-identifier hs-type">openapiKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Key.html#Key"><span class="hs-identifier hs-type">Key</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679221026"><span class="annot"><span class="annottext">openapiKey :: Key
</span><a href="#local-6989586621679221026"><span class="hs-identifier hs-var hs-var">openapiKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;openapi&quot;</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><span class="hs-comment">{- | Vendor extensions extracted from an OpenAPI operation.

These extensions are non-standard fields (prefixed with @x-@) that
Haskemathesis recognizes for controlling test behavior.

=== Supported Extensions

[@x-timeout@] Request timeout in milliseconds. Useful for:

    * Streaming endpoints (SSE, NDJSON) that never complete
    * Slow endpoints that need longer than default timeout
    * Fast endpoints where you want to fail quickly

    Example in OpenAPI spec:

    @
    \/events:
      get:
        x-timeout: 2000  # 2 second timeout
        responses:
          &quot;200&quot;:
            content:
              text/event-stream: {}
    @

=== Why Use Extensions?

OpenAPI 3.x doesn't have a standard way to specify:

* Request timeouts
* Streaming behavior hints
* Test-specific configuration

Vendor extensions (x-* fields) are the OpenAPI-sanctioned way to add
such metadata while remaining spec-compliant.
-}</span></span><span>
</span><span id="line-219"></span><span class="hs-keyword">newtype</span><span> </span><span id="OperationExtensions"><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationExtensions"><span class="hs-identifier hs-var">OperationExtensions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OperationExtensions"><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationExtensions"><span class="hs-identifier hs-var">OperationExtensions</span></a></span></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="oeTimeout"><span class="annot"><span class="annottext">OperationExtensions -&gt; Maybe Int
</span><a href="Haskemathesis.OpenApi.Loader.html#oeTimeout"><span class="hs-identifier hs-var hs-var">oeTimeout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Request timeout in milliseconds from @x-timeout@</span></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679221048"><span id="local-6989586621679221054"><span class="annot"><span class="annottext">OperationExtensions -&gt; OperationExtensions -&gt; Bool
(OperationExtensions -&gt; OperationExtensions -&gt; Bool)
-&gt; (OperationExtensions -&gt; OperationExtensions -&gt; Bool)
-&gt; Eq OperationExtensions
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: OperationExtensions -&gt; OperationExtensions -&gt; Bool
== :: OperationExtensions -&gt; OperationExtensions -&gt; Bool
$c/= :: OperationExtensions -&gt; OperationExtensions -&gt; Bool
/= :: OperationExtensions -&gt; OperationExtensions -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679221063"><span id="local-6989586621679221070"><span id="local-6989586621679221074"><span class="annot"><span class="annottext">Int -&gt; OperationExtensions -&gt; ShowS
[OperationExtensions] -&gt; ShowS
OperationExtensions -&gt; FilePath
(Int -&gt; OperationExtensions -&gt; ShowS)
-&gt; (OperationExtensions -&gt; FilePath)
-&gt; ([OperationExtensions] -&gt; ShowS)
-&gt; Show OperationExtensions
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; FilePath) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; OperationExtensions -&gt; ShowS
showsPrec :: Int -&gt; OperationExtensions -&gt; ShowS
$cshow :: OperationExtensions -&gt; FilePath
show :: OperationExtensions -&gt; FilePath
$cshowList :: [OperationExtensions] -&gt; ShowS
showList :: [OperationExtensions] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="annot"><span class="hs-comment">-- | Key for looking up operation extensions: (path, method)</span></span><span>
</span><span id="line-226"></span><span class="hs-keyword">type</span><span> </span><span id="OperationKey"><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationKey"><span class="hs-identifier hs-var">OperationKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><span class="hs-comment">{- | Load an OpenAPI spec along with vendor extensions.

This function returns both the parsed OpenAPI spec and a map of
vendor extensions for each operation, keyed by (path, method).

=== Example

@
result &lt;- loadOpenApiFileWithExtensions &quot;api.yaml&quot;
case result of
    Left err -&gt; putStrLn $ &quot;Error: &quot; ++ T.unpack err
    Right (spec, extensions) -&gt; do
        -- Look up timeout for GET /events
        let key = (&quot;/events&quot;, &quot;GET&quot;)
        case Map.lookup key extensions of
            Just ext -&gt; print (oeTimeout ext)
            Nothing -&gt; putStrLn &quot;No extensions&quot;
@
-}</span></span><span>
</span><span id="line-247"></span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#loadOpenApiFileWithExtensions"><span class="hs-identifier hs-type">loadOpenApiFileWithExtensions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/n9bq8nyqbcrs9rhllk8bh2xqlhba601s-openapi3-3.2.4-doc/share/doc/openapi3-3.2.4/html/src/Data.OpenApi.Internal.html#OpenApi"><span class="hs-identifier hs-type">OpenApi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationKey"><span class="hs-identifier hs-type">OperationKey</span></a></span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationExtensions"><span class="hs-identifier hs-type">OperationExtensions</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span id="loadOpenApiFileWithExtensions"><span class="annot"><span class="annottext">loadOpenApiFileWithExtensions :: FilePath
-&gt; IO (Either Text (OpenApi, Map OperationKey OperationExtensions))
</span><a href="Haskemathesis.OpenApi.Loader.html#loadOpenApiFileWithExtensions"><span class="hs-identifier hs-var hs-var">loadOpenApiFileWithExtensions</span></a></span></span><span> </span><span id="local-6989586621679221079"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679221079"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621679221080"><span class="annot"><a href="#local-6989586621679221080"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Either ParseException Value)
forall a. FromJSON a =&gt; FilePath -&gt; IO (Either ParseException a)
</span><a href="file:///nix/store/5yy64md1ny6jpffrkgsq9gn90diwkshl-yaml-0.11.11.2-doc/share/doc/yaml-0.11.11.2/html/src/Data.Yaml.html#decodeFileEither"><span class="hs-identifier hs-var">decodeFileEither</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679221079"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679221080"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679221081"><span class="annot"><span class="annottext">ParseException
</span><a href="#local-6989586621679221081"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text (OpenApi, Map OperationKey OperationExtensions)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParseException -&gt; FilePath
</span><a href="file:///nix/store/5yy64md1ny6jpffrkgsq9gn90diwkshl-yaml-0.11.11.2-doc/share/doc/yaml-0.11.11.2/html/src/Data.Yaml.Internal.html#prettyPrintParseException"><span class="hs-identifier hs-var">prettyPrintParseException</span></a></span><span> </span><span class="annot"><span class="annottext">ParseException
</span><a href="#local-6989586621679221081"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679221082"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679221082"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679221083"><span class="annot"><span class="annottext">transformed :: Value
</span><a href="#local-6989586621679221083"><span class="hs-identifier hs-var hs-var">transformed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="Haskemathesis.OpenApi.Loader.html#transformOpenApi31To30"><span class="hs-identifier hs-var">transformOpenApi31To30</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679221082"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-256"></span><span>                </span><span id="local-6989586621679221084"><span class="annot"><span class="annottext">extensions :: Map OperationKey OperationExtensions
</span><a href="#local-6989586621679221084"><span class="hs-identifier hs-var hs-var">extensions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Map OperationKey OperationExtensions
</span><a href="Haskemathesis.OpenApi.Loader.html#extractOperationExtensions"><span class="hs-identifier hs-var">extractOperationExtensions</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679221082"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-257"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Result OpenApi
forall a. FromJSON a =&gt; Value -&gt; Result a
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.FromJSON.html#fromJSON"><span class="hs-identifier hs-var">fromJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679221083"><span class="hs-identifier hs-var">transformed</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-258"></span><span>                    </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621679221085"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679221085"><span class="hs-identifier hs-var">err'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text (OpenApi, Map OperationKey OperationExtensions)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679221085"><span class="hs-identifier hs-var">err'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>                    </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Success"><span class="hs-identifier hs-type">Success</span></a></span><span> </span><span id="local-6989586621679221086"><span class="annot"><span class="annottext">OpenApi
</span><a href="#local-6989586621679221086"><span class="hs-identifier hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(OpenApi, Map OperationKey OperationExtensions)
-&gt; Either Text (OpenApi, Map OperationKey OperationExtensions)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OpenApi
</span><a href="#local-6989586621679221086"><span class="hs-identifier hs-var">spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map OperationKey OperationExtensions
</span><a href="#local-6989586621679221084"><span class="hs-identifier hs-var">extensions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><span class="hs-comment">{- | Extract vendor extensions from all operations in a raw OpenAPI JSON value.

This function walks the paths and operations in the raw JSON to extract
x-* fields before they are discarded by the openapi3 library parser.

Returns a map from (path, method) to the extracted extensions.
-}</span></span><span>
</span><span id="line-268"></span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#extractOperationExtensions"><span class="hs-identifier hs-type">extractOperationExtensions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationKey"><span class="hs-identifier hs-type">OperationKey</span></a></span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationExtensions"><span class="hs-identifier hs-type">OperationExtensions</span></a></span><span>
</span><span id="line-269"></span><span id="extractOperationExtensions"><span class="annot"><span class="annottext">extractOperationExtensions :: Value -&gt; Map OperationKey OperationExtensions
</span><a href="Haskemathesis.OpenApi.Loader.html#extractOperationExtensions"><span class="hs-identifier hs-var hs-var">extractOperationExtensions</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679221087"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221087"><span class="hs-identifier hs-var">root</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#lookup"><span class="hs-identifier hs-var">KM.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;paths&quot;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221087"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679221088"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221088"><span class="hs-identifier hs-var">paths</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-272"></span><span>            </span><span class="annot"><span class="annottext">[(OperationKey, OperationExtensions)]
-&gt; Map OperationKey OperationExtensions
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span>
</span><span id="line-273"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679221090"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679221091"><span class="hs-identifier hs-var">method</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OperationExtensions
</span><a href="#local-6989586621679221092"><span class="hs-identifier hs-var">ext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679221093"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221093"><span class="hs-identifier hs-var">pathKey</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679221094"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221094"><span class="hs-identifier hs-var">pathItem</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Object -&gt; [(Key, Value)]
forall v. KeyMap v -&gt; [(Key, v)]
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#toList"><span class="hs-identifier hs-var">KM.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221088"><span class="hs-identifier hs-var">paths</span></a></span><span>
</span><span id="line-275"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679221090"><span class="annot"><span class="annottext">path :: Text
</span><a href="#local-6989586621679221090"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Key.html#toText"><span class="hs-identifier hs-var">Key.toText</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221093"><span class="hs-identifier hs-var">pathKey</span></a></span><span>
</span><span id="line-276"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679221097"><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221097"><span class="hs-identifier hs-var">methodKey</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Object"><span class="hs-identifier hs-type">Object</span></a></span><span> </span><span id="local-6989586621679221098"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221098"><span class="hs-identifier hs-var">operation</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Object -&gt; [(Key, Value)]
forall v. KeyMap v -&gt; [(Key, v)]
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#toList"><span class="hs-identifier hs-var">KM.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221094"><span class="hs-identifier hs-var">pathItem</span></a></span><span>
</span><span id="line-277"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679221091"><span class="annot"><span class="annottext">method :: Text
</span><a href="#local-6989586621679221091"><span class="hs-identifier hs-var hs-var">method</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toUpper</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Key -&gt; Text
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Key.html#toText"><span class="hs-identifier hs-var">Key.toText</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><a href="#local-6989586621679221097"><span class="hs-identifier hs-var">methodKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679221091"><span class="hs-identifier hs-var">method</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="Haskemathesis.OpenApi.Loader.html#httpMethods"><span class="hs-identifier hs-var">httpMethods</span></a></span><span>
</span><span id="line-279"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679221092"><span class="annot"><span class="annottext">ext :: OperationExtensions
</span><a href="#local-6989586621679221092"><span class="hs-identifier hs-var hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Object -&gt; OperationExtensions
</span><a href="Haskemathesis.OpenApi.Loader.html#extractExtensionsFromOperation"><span class="hs-identifier hs-var">extractExtensionsFromOperation</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221098"><span class="hs-identifier hs-var">operation</span></a></span><span>
</span><span id="line-280"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-281"></span><span>        </span><span id="local-6989586621679221103"><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621679221103"><span class="hs-identifier hs-var">_noPaths</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map OperationKey OperationExtensions
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-282"></span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#extractOperationExtensions"><span class="hs-identifier hs-var">extractOperationExtensions</span></a></span><span> </span><span id="local-6989586621679221105"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679221105"><span class="hs-identifier hs-var">_notObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map OperationKey OperationExtensions
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="annot"><span class="hs-comment">-- | HTTP methods to look for in path items</span></span><span>
</span><span id="line-285"></span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#httpMethods"><span class="hs-identifier hs-type">httpMethods</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-286"></span><span id="httpMethods"><span class="annot"><span class="annottext">httpMethods :: [Text]
</span><a href="Haskemathesis.OpenApi.Loader.html#httpMethods"><span class="hs-identifier hs-var hs-var">httpMethods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;GET&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;PUT&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;POST&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DELETE&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;OPTIONS&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;HEAD&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;PATCH&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;TRACE&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="annot"><span class="hs-comment">-- | Extract extensions from a single operation object</span></span><span>
</span><span id="line-289"></span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#extractExtensionsFromOperation"><span class="hs-identifier hs-type">extractExtensionsFromOperation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationExtensions"><span class="hs-identifier hs-type">OperationExtensions</span></a></span><span>
</span><span id="line-290"></span><span id="extractExtensionsFromOperation"><span class="annot"><span class="annottext">extractExtensionsFromOperation :: Object -&gt; OperationExtensions
</span><a href="Haskemathesis.OpenApi.Loader.html#extractExtensionsFromOperation"><span class="hs-identifier hs-var hs-var">extractExtensionsFromOperation</span></a></span></span><span> </span><span id="local-6989586621679221106"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221106"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#OperationExtensions"><span class="hs-identifier hs-type">OperationExtensions</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">oeTimeout :: Maybe Int
</span><a href="Haskemathesis.OpenApi.Loader.html#oeTimeout"><span class="hs-identifier hs-var">oeTimeout</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Object -&gt; Maybe Int
</span><a href="Haskemathesis.OpenApi.Loader.html#extractTimeout"><span class="hs-identifier hs-var">extractTimeout</span></a></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221106"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-293"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="annot"><span class="hs-comment">-- | Extract x-timeout as milliseconds (Int)</span></span><span>
</span><span id="line-296"></span><span class="annot"><a href="Haskemathesis.OpenApi.Loader.html#extractTimeout"><span class="hs-identifier hs-type">extractTimeout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#KeyMap"><span class="hs-identifier hs-type">KM.KeyMap</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-297"></span><span id="extractTimeout"><span class="annot"><span class="annottext">extractTimeout :: Object -&gt; Maybe Int
</span><a href="Haskemathesis.OpenApi.Loader.html#extractTimeout"><span class="hs-identifier hs-var hs-var">extractTimeout</span></a></span></span><span> </span><span id="local-6989586621679221108"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221108"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Key -&gt; Object -&gt; Maybe Value
forall v. Key -&gt; KeyMap v -&gt; Maybe v
</span><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.KeyMap.html#lookup"><span class="hs-identifier hs-var">KM.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;x-timeout&quot;</span></span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679221108"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/bjx03k98335ijsml9dq303bj5ddk8a5f-aeson-2.2.3.0-doc/share/doc/aeson-2.2.3.0/html/src/Data.Aeson.Types.Internal.html#Number"><span class="hs-identifier hs-type">Number</span></a></span><span> </span><span id="local-6989586621679221109"><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679221109"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Maybe Int
forall i. (Integral i, Bounded i) =&gt; Scientific -&gt; Maybe i
</span><a href="file:///nix/store/hwr0895a4mk8gp1c52mqxqwygppa2imi-scientific-0.3.8.0-doc/share/doc/scientific-0.3.8.0/html/src/Data.Scientific.html#toBoundedInteger"><span class="hs-identifier hs-var">toBoundedInteger</span></a></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679221109"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-300"></span><span>        </span><span id="local-6989586621679221110"><span class="annot"><span class="annottext">Maybe Value
</span><a href="#local-6989586621679221110"><span class="hs-identifier hs-var">_notNumber</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Int
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-301"></span></pre></body></html>